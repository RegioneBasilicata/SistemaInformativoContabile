<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="../dbdoc.js" type="text/javascript"></script>
<link href="../dbdoc.css" type="text/css" rel="stylesheet">
</head>
<body class="object">
<div id="header"><h2>BLOB_MAIL</h2>
<div class="tabs clearfix">

<div class="tab"><div><a href="BLOB_MAIL.html">Details</a></div></div>
<div class="tab"><div><a href="BLOB_MAIL_Grants.html">Grants</a></div></div>
<div class="tab"><div><a href="BLOB_MAIL_References.html">References</a></div></div>
<div class="tab"><div><a href="BLOB_MAIL_Dependencies.html">Dependencies</a></div></div>
<div class="tab" id="current"><div><a href="BLOB_MAIL_Code.html">Code</a></div></div>
</div></div><br/>
<div class="tab-panes">
<div id="Code"> <table cellpadding="0" cellspacing="0" cellspacing="0" summary=""><tr>
	<th>TEXT</th>
</tr>
	<tr><td><pre>
procedure blob_mail(
    p_sender     varchar2, -- sender, example: 'Me &lt;me@apple.com>'
    p_recipients varchar2, -- recipients, example: 'Someone &lt;someone@pear.com>'
    p_subject    varchar2, -- subject
	  p_text		 varchar2, -- text
    p_filename	 varchar2, -- name of pdf file
	  p_blob		 blob 	   -- pdf file
) is
  conn      utl_smtp.connection;
  i number;
  len number;
  app_p_blob  blob;
  app_p_filename varchar2(100);
BEGIN
  conn := demo_mail.begin_mail(
    sender     => p_sender,
    recipients => p_recipients,
    subject    => p_subject,
    mime_type  => demo_mail.MULTIPART_MIME_TYPE);
    app_p_filename:=p_filename;
    app_p_blob:=p_blob;
  demo_mail.begin_attachment(
    conn         => conn,
    mime_type    => 'application/xls',
    inline       => TRUE,
    filename     => app_p_filename,
    transfer_enc => 'base64');
    -- split the Base64 encoded attachment into multiple lines
   i   := 1;
   len := DBMS_LOB.getLength(app_p_blob);
   WHILE (i &lt; len) LOOP
      IF(i + demo_mail.MAX_BASE64_LINE_WIDTH &lt; len)THEN
         UTL_SMTP.Write_Raw_Data (conn
                                , UTL_ENCODE.Base64_Encode(
                                        DBMS_LOB.Substr(app_p_blob, demo_mail.MAX_BASE64_LINE_WIDTH, i)));
      ELSE
         UTL_SMTP.Write_Raw_Data (conn
                                , UTL_ENCODE.Base64_Encode(
                                        DBMS_LOB.Substr(app_p_blob, (len - i)+1,  i)));
      END IF;
      UTL_SMTP.Write_Data(conn, UTL_TCP.CRLF);
      i := i + demo_mail.MAX_BASE64_LINE_WIDTH;
   END LOOP;
  demo_mail.end_attachment(conn => conn);
  demo_mail.attach_text(
    conn      => conn,
    data      => p_text,
    mime_type => 'text/html');
  demo_mail.end_mail( conn => conn );
END;</pre>	</td></tr>
</table></div>