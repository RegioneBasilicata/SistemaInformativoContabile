<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="../dbdoc.js" type="text/javascript"></script>
<link href="../dbdoc.css" type="text/css" rel="stylesheet">
</head>
<body class="object">
<div id="header"><h2>EQUILIBRI_ASSESTAMENTO</h2>
<div class="tabs clearfix">

<div class="tab"><div><a href="EQUILIBRI_ASSESTAMENTO.html">Details</a></div></div>
<div class="tab"><div><a href="EQUILIBRI_ASSESTAMENTO_Grants.html">Grants</a></div></div>
<div class="tab"><div><a href="EQUILIBRI_ASSESTAMENTO_References.html">References</a></div></div>
<div class="tab"><div><a href="EQUILIBRI_ASSESTAMENTO_Dependencies.html">Dependencies</a></div></div>
<div class="tab" id="current"><div><a href="EQUILIBRI_ASSESTAMENTO_Code.html">Code</a></div></div>
</div></div><br/>
<div class="tab-panes">
<div id="Code"> <table cellpadding="0" cellspacing="0" cellspacing="0" summary=""><tr>
	<th>TEXT</th>
</tr>
	<tr><td><pre>
procedure EQUILIBRI_ASSESTAMENTO(p_anno in number,p_utente in varchar2,p_id_report in number) as

 riga NUMBER;
 c1 VARCHAR2(1000); c2 VARCHAR2(10);
 n1 NUMBER; n2 NUMBER; n3 NUMBER;
 v1 NUMBER; v2 NUMBER; v3 NUMBER; 
 p_anno1 number(4);
 p_anno2 number(4);

 
 
BEGIN
 DELETE tmp_tabulati 
 WHERE utente = p_utente;
 COMMIT;
 
 p_anno1 := p_anno + 1;
 p_anno2 := p_anno + 2;

 
 
 riga := 1;
 c1 := 'Utilizzo risultato di amministrazione presunto vincolato per il finanziamento di spese correnti (titoli 1  chiave contabile avanzo)';
 c2 := '(+)';
 SELECT NVL(SUM(equilibri_bil_ass_segment9(p_anno,a.eu||a.codice,'AVANZO')),0) +
        NVL(SUM(equilibri_bil_ass_segment9(p_anno,a.eu||a.codice,'AV_REG')),0) +
        NVL(SUM(equilibri_bil_ass_segment9(p_anno,a.eu||a.codice,'AV_RP')),0) ucompe
 INTO n1
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       l3.id = 1 /* titolo 1 */ ;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,NULL,NULL,p_utente,riga);   


 riga := 2;
 c1 := 'Dato da impostare manualmente';
 c2 := '(-)';
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN 
  SELECT descrizione_campo_report,'(-)',NVL(importo,0) importo
  INTO c1,c2,n1
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'RDPAEP_ANNO';
  SELECT descrizione_campo_report,'(-)',NVL(importo,0) importo
  INTO c1,c2,n2
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'RDPAEP_ANNO+1';
  SELECT descrizione_campo_report,'(-)',NVL(importo,0) importo
  INTO c1,c2,n3
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'RDPAEP_ANNO+2';
 EXCEPTION 
  WHEN OTHERS THEN NULL;
 END;      
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   
 
 riga := 3;
 c1 := 'Fondo pluriennale vincolato per spese correnti iscritto in entrata';
 c2 := '(+)';
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN
  SELECT  NVL(fpv_corrente,0) + NVL(variazione_fpv_corrente,0) ecompe
  INTO n1
  FROM fin_t_dati_generali dg
  WHERE dg.anno_finanziario = p_anno;
  SELECT NVL(fpv_corrente,0) + NVL(variazione_fpv_corrente,0) ecompe1
  INTO n2
  FROM fin_t_dati_generali dg
  WHERE dg.anno_finanziario = p_anno1;
  SELECT NVL(fpv_corrente,0) + NVL(variazione_fpv_corrente,0) ecompe2
  INTO n3
  FROM fin_t_dati_generali dg
  WHERE dg.anno_finanziario = p_anno2; 
  INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
  VALUES (c1,c2,n1,n2,n3,p_utente,riga);   
 EXCEPTION WHEN NO_DATA_FOUND
   THEN null;--srw.message(001,'In tabella Dati Ente non ci sono tre anni a partire dall''anno indicato per il report');
 END;

 riga := 4;
 c1 := 'Entrate titoli 1-2-3';
 c2 := '(+)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       NVL(SUBSTR(l1.codice,1,1),'1') &lt; '4';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   


 riga := 5;
 c1 := 'Entrate in conto capitale per Contributi agli investimenti direttamente destinati al rimborso dei prestiti da amministrazioni pubbliche';
 c2 := '(+)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2      
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       SUBSTR(a.nb_piano_conti_fina,1,9) = 'E.4.02.06';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 6;
 c1 := 'Entrate Titolo 4.03 - Altri trasferimenti in conto capitale';
 c2 := '(+)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       a.nb_piano_conti_fina LIKE 'E.4.03%';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   


-- modifica pierro 28.07.2015 la riga 7 scompare e diventa riga 14.
  
 riga := 8;
 c1 := 'Dato da impostare manualmente';
 c2 := '(+)';
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN 
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n1
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'ECCDEAP_ANNO';
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n2
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'ECCDEAP_ANNO+1';
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n3
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'ECCDEAP_ANNO+2';
 EXCEPTION 
  WHEN OTHERS THEN NULL;
 END;      
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   
 
 riga := 9;
 c1 := 'Dato da impostare manualmente';
 c2 := '(+)';
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN 
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n1
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EAPDEAP_ANNO';
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n2
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EAPDEAP_ANNO+1';
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n3
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EAPDEAP_ANNO+2';
 EXCEPTION 
  WHEN OTHERS THEN NULL;
 END;      
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 10;
 c1 := 'Dato da impostare manualmente';
 c2 := '(+)';
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN 
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n1
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EPCDSCBSDLPC_ANNO';
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n2
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EPCDSCBSDLPC_ANNO+1';
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n3
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EPCDSCBSDLPC_ANNO+2';
 EXCEPTION 
  WHEN OTHERS THEN NULL;
 END;      
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 11;
 c1 := 'Spese correnti';
 c2 := '(-)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2,
        NVL(SUM(assestamento_com_iniziale(p_anno,a.nb_capitolo_fpv))+SUM(assestamento_competenza(p_anno,a.nb_capitolo_fpv)),0) ufv_compe,
        NVL(SUM(assestamento_com_iniziale(p_anno1,a.nb_capitolo_fpv))+SUM(assestamento_competenza(p_anno1,a.nb_capitolo_fpv)),0) ufv_plur1,
        NVL(SUM(assestamento_com_iniziale(p_anno2,a.nb_capitolo_fpv))+SUM(assestamento_competenza(p_anno2,a.nb_capitolo_fpv)),0) ufv_plur2
 INTO n1, n2, n3,
      v1,v2,v3
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       l3.id = 1 /* titolo 1 */ ;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   
 
 riga := 12;
 c1 := '  -  di cui al fondo pluriennale vincolato';
 c2 := NULL;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,v1,v2,v3,p_utente,riga);   

 riga := 13;
 c1 := 'Spese Titolo 2.04 - Altri trasferimenti in conto capitale';
 c2 := '(-)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2      
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       a.nb_piano_conti_fina LIKE 'U.2.04%';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   
 
 -- modifica Pierro vedi riga 7.
 --
 riga := 14;
 c1 := 'Variazioni di attività finanziarie (se negativo)';
 c2 := '(-)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       a.nb_piano_conti_fina LIKE 'E.5%';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2      
 INTO v1, v2, v3
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       a.nb_piano_conti_fina LIKE 'U.3%';
 n1 := n1 - v1; 
 n2 := n2 - v2;
 n3 := n3 - v3;
 if n1>0 
     then n1:=0;
 end if;    
 if n2>0 
     then n2:=0;
 end if;    
 if n3>0 
     then n3:=0;
 end if;    
INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
VALUES (c1,c2,abs(n1),abs(n2),abs(n3),p_utente,riga);   

 
 riga := 15;
 c1 := 'Rimborso prestiti';
 c2 := '(-)';
 INTO n1, n2, n3
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2      
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       l3.id = 4 /* titolo 4 */ ;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   
 
 riga := 16;
 c1 := 'Dato da impostare manualmente';
 c2 := NULL;
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN 
  SELECT descrizione_campo_report,NULL,NVL(importo,0) importo
  INTO c1,c2,n1
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'DICUIEAP_ANNO';
  SELECT descrizione_campo_report,NULL,NVL(importo,0) importo
  INTO c1,c2,n2
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'DICUIEAP_ANNO+1';
  SELECT descrizione_campo_report,NULL,NVL(importo,0) importo
  INTO c1,c2,n3
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'DICUIEAP_ANNO+2';
 EXCEPTION 
  WHEN OTHERS THEN NULL;
 END;      
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 17;
 c1 := 'A) Equilibrio di parte corrente ';
 c2 := NULL;
 n1 := 0;  n2 := 0; n3 := 0;
 SELECT SUM(DECODE(num_ord_riga,1,num01,2,num01*(-1),3,num01,4,num01,5,num01,6,num01,8,num01,9,num01,10,num01,11,num01*(-1),13,num01*(-1),14,num01*(-1),15,num01*(-1),0)) compe,
        SUM(DECODE(num_ord_riga,1,num02,2,num02*(-1),3,num02,4,num02,5,num02,6,num02,8,num02,9,num02,10,num02,11,num02*(-1),13,num02*(-1),14,num02*(-1),15,num02*(-1),0)) compe1,
        SUM(DECODE(num_ord_riga,1,num03,2,num03*(-1),3,num03,4,num03,5,num03,6,num03,8,num03,9,num03,10,num03,11,num03*(-1),13,num03*(-1),14,num03*(-1),15,num03*(-1),0)) compe2
 INTO n1,n2,n3
 FROM tmp_tabulati 
 WHERE utente = p_utente;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 18;
 c1 := NULL;
 c2 := NULL;
 n1 := NULL;  n2 := NULL; n3 := NULL;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 19;
 c1 := 'Utilizzo risultato presunto di amministrazione vincolato per il finanziamento di spese d¿investimento';
 c2 := '(+)';
 SELECT NVL(SUM(equilibri_bil_ass_segment9(p_anno,a.eu||a.codice,'AVANZO')),0) +
        NVL(SUM(equilibri_bil_ass_segment9(p_anno,a.eu||a.codice,'AV_REG')),0) +
        NVL(SUM(equilibri_bil_ass_segment9(p_anno,a.eu||a.codice,'AV_RP')),0) ucompe
 INTO n1
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       l3.id IN (2,4) /* titoli 2,4 */ ;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,NULL,NULL,p_utente,riga);   

 riga := 20;
 c1 := 'Fondo pluriennale vincolato per spese in conto capitale iscritto in entrata';
 c2 := '(+)';
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN
  SELECT NVL(dg.fpv_capitale,0) +  NVL(dg.variazione_fpv_capitale,0) ecompe
  INTO n1
  FROM fin_t_dati_generali dg
  WHERE dg.anno_finanziario = p_anno;
  SELECT NVL(dg.fpv_capitale,0) +  NVL(dg.variazione_fpv_capitale,0) ecompe1
  INTO n2
  FROM fin_t_dati_generali dg
  WHERE dg.anno_finanziario = p_anno1;
  SELECT NVL(dg.fpv_capitale,0) +  NVL(dg.variazione_fpv_capitale,0) ecompe2
  INTO n3
  FROM fin_t_dati_generali dg
  WHERE dg.anno_finanziario = p_anno2; 
  INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
  VALUES (c1,c2,n1,n2,n3,p_utente,riga);   
 EXCEPTION WHEN NO_DATA_FOUND
   THEN null;--srw.message(001,'In tabella Dati Ente non ci sono tre anni a partire dall''anno indicato per il report');
 END;

 riga := 21;
 c1 := 'Entrate in conto capitale (Titolo 4)';
 c2 := '(+)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2      
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       NVL(SUBSTR(l1.codice,1,1),'1') = '4';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 c1 := 'Entrate Titolo 5.01.01 - Alienazioni  di partecipazioni ';
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 22;
 c2 := '(+)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2      
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       a.nb_piano_conti_fina LIKE '5.01.0%';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 23;
 c1 := 'Entrate per accensioni di prestiti (Titolo 6)';
 c2 := '(+)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2      
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       NVL(SUBSTR(l1.codice,1,1),'1') = '6';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 24;
 c1 := 'Entrate in conto capitale per Contributi agli investimenti direttamente destinati al rimborso dei prestiti da amministrazioni pubbliche';
 c2 := '(-)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2      
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       a.nb_piano_conti_fina LIKE 'E.4.02.06%';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga); 

 riga := 25;
 c1 := 'Entrate in c/capitale destinate all''estinzione anticipata di prestiti';
 c2 := '(-)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2      
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       a.nb_piano_conti_fina LIKE 'E.4.04.01.08%';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga); 

 riga := 26;
 c1 := 'Dato da impostare manualmente';
 c2 := '(-)';
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN 
  SELECT descrizione_campo_report,NULL,NVL(importo,0) importo
  INTO c1,c2,n1
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EPCDSCBSDLPC_CAP_ANNO';
  SELECT descrizione_campo_report,NULL,NVL(importo,0) importo
  INTO c1,c2,n2
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EPCDSCBSDLPC_CAP_ANNO+1';
  SELECT descrizione_campo_report,NULL,NVL(importo,0) importo
  INTO c1,c2,n3
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EPCDSCBSDLPC_CAP_ANNO+2';
 EXCEPTION 
  WHEN OTHERS THEN NULL;
 END;      
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 27;
 c1 := 'Dato da impostare manualmente';
 c2 := '(+)';
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN 
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n1
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
  FROM fnd_reports_importi_man
        nome_campo_report = 'EAPDEAP_CAP_ANNO';
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n2
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EAPDEAP_CAP_ANNO+1';
  SELECT descrizione_campo_report,'(+)',NVL(importo,0) importo
  INTO c1,c2,n3
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'EAPDEAP_CAP_ANNO+2';
 EXCEPTION 
  WHEN OTHERS THEN NULL;
 END;      
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 28;
 c1 := 'Entrate Titolo 4.03 - Altri trasferimenti in conto capitale';
 c2 := '(+)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       a.nb_piano_conti_fina LIKE 'E.4.03%';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 29;
 c1 := 'Spese in conto capitale';
 c2 := '(-)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2,
        NVL(SUM(assestamento_com_iniziale(p_anno,a.nb_capitolo_fpv))+SUM(assestamento_competenza(p_anno,a.nb_capitolo_fpv)),0) ufv_compe,
        NVL(SUM(assestamento_com_iniziale(p_anno1,a.nb_capitolo_fpv))+SUM(assestamento_competenza(p_anno1,a.nb_capitolo_fpv)),0) ufv_plur1,
        NVL(SUM(assestamento_com_iniziale(p_anno2,a.nb_capitolo_fpv))+SUM(assestamento_competenza(p_anno2,a.nb_capitolo_fpv)),0) ufv_plur2
 INTO n1, n2, n3,
      v1,v2,v3
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       l3.id = 2 /* titolo 2 */ ;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   
 
 riga := 30;
 c1 := '  -  di cui al fondo pluriennale vincolato';
 c2 := NULL;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,v1,v2,v3,p_utente,riga);   

 riga := 31;
 c1 := 'Spese Titolo 2.04 - Altri trasferimenti in conto capitale'; 
 c2 := '(+)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2        
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       a.nb_piano_conti_fina LIKE 'U.2.04%';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 -- 08/01/2014     f.coretti. Pierro fa notare che a seconda dell'anno questo criterio potrebbe  
 -- non essere valido e pertanto si concorda una gestione manuale
 -- riga := 32;
 -- c1 := 'Spese Titolo 3.01.01 - Acquisizioni di partecipazioni e conferimenti di capitale'; 
 -- c2 := '(-)';
 --SELECT NVL(SUM(previsione_iniziale(p_anno,a.eu||a.codice)),0)  ucompe,
    --    NVL(SUM(pluriennale1_iniziale(p_anno1,a.eu||a.codice)),0) uplur1,
    --    NVL(SUM(pluriennale2_iniziale(p_anno2,a.eu||a.codice)),0) uplur2
 --INTO n1, n2, n3
 --FROM fin_t_articoli a,
   --   nb_titoli_uscite l3
 --WHERE a.anno = p_anno AND
   --    a.abilitato = 'S' AND
   --    a.eu = 'U' AND
   --    l3.anno(+) = a.anno AND
   --    l3.id(+) = NVL(a.nb_titolo,0) AND
   --    a.nb_piano_conti_fina LIKE 'U.3.01.01%';
 --INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 --VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 32;
 c1 := 'Dato da impostare manualmente';
 c2 := '(-)';
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN 
  SELECT descrizione_campo_report,'(-)',NVL(importo,0) importo
  INTO c1,c2,n1
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'APCC_ANNO';
  SELECT descrizione_campo_report,'(-)',NVL(importo,0) importo
  INTO c1,c2,n2
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
  INTO c1,c2,n3
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'APCC_ANNO+1';
  SELECT descrizione_campo_report,'(-)',NVL(importo,0) importo
  FROM fnd_reports_importi_man
  WHERE valore_parametro_anno = p_anno AND
        id_report = TO_NUMBER(p_id_report) AND
        nome_campo_report = 'APCC_ANNO+2';
 EXCEPTION 
  WHEN OTHERS THEN NULL;
 END;      
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 33;
 c1 := 'Disavanzo pregresso derivante da debito autorizzato e non contratto (presunto)'; 
 c2 := '(-)';
 n1 := 0;  n2 := 0; n3 := 0;
 BEGIN
  SELECT -- NVL(disavanzo_effettivo_anni_prec,0) 
  NVL(disavanzo_regionale,0) ecompe
  INTO n1
  FROM fin_t_dati_generali dg
  WHERE dg.anno_finanziario = p_anno;
  SELECT --NVL(disavanzo_effettivo_anni_prec,0)
  NVL(disavanzo_regionale,0) ecompe1
  INTO n2
  FROM fin_t_dati_generali dg
  WHERE dg.anno_finanziario = p_anno1;
  SELECT --NVL(disavanzo_effettivo_anni_prec,0)
  NVL(disavanzo_regionale,0) ecompe2
  INTO n3
  FROM fin_t_dati_generali dg
  WHERE dg.anno_finanziario = p_anno2; 
  INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
  VALUES (c1,c2,n1,n2,n3,p_utente,riga);   
 EXCEPTION WHEN NO_DATA_FOUND
   THEN null;--srw.message(001,'In tabella Dati Ente non ci sono tre anni a partire dall''anno indicato per il report');
 END;

-- modifica Pierro vedi riga 7 - ho aggiunto la riga 34 shifttando le altre e riconsiderando il calcolo del totale..
 --
 riga := 34;
 c1 := 'Variazioni di attività finanziarie (se positivo)';
 c2 := '(-)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       a.nb_piano_conti_fina LIKE 'E.5%';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2      
 INTO v1, v2, v3
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       a.nb_piano_conti_fina LIKE 'U.3%';
 n1 := n1 - v1; 
 n2 := n2 - v2;
 n3 := n3 - v3;
 if n1&lt;0 
     then n1:=0;
 end if;    
 if n2&lt;0 
     then n2:=0;
 end if;    
 if n3&lt;0 
     then n3:=0;
 end if;    
INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 c1 := 'B) Equilibrio di parte capitale ';
VALUES (c1,c2,abs(n1),abs(n2),abs(n3),p_utente,riga);   

 riga := 35;
 c2 := NULL;
 n1 := 0;  n2 := 0; n3 := 0;
 SELECT SUM(DECODE(num_ord_riga,19,num01,20,num01,21,num01,22,num01,23,num01,24,num01*(-1),25,num01*(-1),27,num01*(-1),28,num01*(-1),29,num01*(-1),31,num01,32,num01*(-1),33,num01*(-1),34,num01,0)) compe,
        SUM(DECODE(num_ord_riga,19,num02,20,num02,21,num02,22,num02,23,num02,24,num02*(-1),25,num02*(-1),27,num02*(-1),28,num02*(-1),29,num02*(-1),31,num02,32,num02*(-1),33,num02*(-1),34,num02,0)) compe1,
        SUM(DECODE(num_ord_riga,19,num03,20,num03,21,num03,22,num03,23,num03,24,num03*(-1),25,num03*(-1),27,num03*(-1),28,num03*(-1),29,num03*(-1),31,num03,32,num03*(-1),33,num03*(-1),34,num03,0)) compe2
 INTO n1,n2,n3
 FROM tmp_tabulati 
 WHERE utente = p_utente;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 36;
 c1 := NULL;
 c2 := NULL;
 n1 := NULL;  n2 := NULL; n3 := NULL;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 37;
 c1 := 'Utilizzo risultato presunto di amministrazione vincolato al finanziamento di attività finanziarie';
 c2 := '(+)';
 SELECT NVL(SUM(equilibri_bil_ass_segment9(p_anno,a.eu||a.codice,'AVANZO')),0) +
        NVL(SUM(equilibri_bil_ass_segment9(p_anno,a.eu||a.codice,'AV_REG')),0) +
        NVL(SUM(equilibri_bil_ass_segment9(p_anno,a.eu||a.codice,'AV_RP')),0) ucompe
 INTO n1
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       l3.id = 3 /* titolo 3 */ ;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,NULL,NULL,p_utente,riga);   

 riga := 38;
 c1 := 'Entrate titolo titolo 5 - Riduzioni attività finanziarie';
 c2 := '(+)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2        
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_livello1 l1,
      nb_livello2 l2,
      nb_livello3 l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.id(+) = a.nb_id_padre AND
       l2.id(+) = l3.id_livello2 AND
       l1.id(+) = l2.id_livello1 AND
       NVL(SUBSTR(l1.codice,1,1),'1') = '5';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 39;
 c1 := 'Spese titolo 3.00 - Incremento attività finanziarie';
 c2 := '(-)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2        
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       l3.id = 3 /* titolo 3 */ ;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   
  
 riga := 40;
 c1 := 'Entrate Titolo 5.01.01 - Alienazioni  di partecipazioni'; 
 c2 := '(-)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2        
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'E' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       a.nb_piano_conti_fina LIKE 'E.5.01.01%';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 41;
 c1 := 'Spese Titolo 3.01.01 - Acquisizioni di partecipazioni e conferimenti di capitale '; 
 c2 := '(+)';
 SELECT NVL(SUM(assestamento_com_iniziale(p_anno,a.eu||a.codice))+SUM(assestamento_competenza(p_anno,a.eu||a.codice)),0) ecompe,
        NVL(SUM(assestamento_pl1_iniziale(p_anno1,a.eu||a.codice))+SUM(assestamento_pluriennale1(p_anno1,a.eu||a.codice)),0) eplur1,
        NVL(SUM(assestamento_pl2_iniziale(p_anno2,a.eu||a.codice))+SUM(assestamento_pluriennale2(p_anno2,a.eu||a.codice)),0) eplur2
 INTO n1, n2, n3
 FROM fin_t_articoli a,
      nb_titoli_uscite l3
 WHERE a.anno = p_anno AND
       a.abilitato = 'S' AND
       a.eu = 'U' AND
       l3.anno(+) = a.anno AND
       l3.id(+) = NVL(a.nb_titolo,0) AND
       a.nb_piano_conti_fina LIKE 'U.3.01.01%';
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 riga := 42;
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   


 c1 := 'C) Variazioni attività finanziaria ';
 c2 := NULL;
 n1 := 0;  n2 := 0; n3 := 0;
 SELECT SUM(DECODE(num_ord_riga,37,num01,38,num01,39,num01*(-1),40,num01*(-1),41,num01,0)) compe,
        SUM(DECODE(num_ord_riga,37,num02,38,num02,39,num02*(-1),40,num02*(-1),41,num02,0)) compe1,
        SUM(DECODE(num_ord_riga,37,num03,38,num03,39,num03*(-1),40,num03*(-1),41,num03,0)) compe2
 INTO n1,n2,n3
 FROM tmp_tabulati 
 WHERE utente = p_utente;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 43;
 c1 := NULL;
 c2 := NULL;
 n1 := NULL;  n2 := NULL; n3 := NULL;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 riga := 44;
 c1 := 'EQUILIBRIO FINALE (D=A+B) ';
 c2 := NULL;
 n1 := 0;  n2 := 0; n3 := 0;
 SELECT SUM(DECODE(num_ord_riga,17,num01,35,num01,0)) compe,
        SUM(DECODE(num_ord_riga,17,num02,35,num02,0)) compe1,
        SUM(DECODE(num_ord_riga,17,num03,35,num03,0)) compe2
 INTO n1,n2,n3
 FROM tmp_tabulati 
 WHERE utente = p_utente;
 INSERT INTO tmp_tabulati (car01,car02,num01,num02,num03,utente,num_ord_riga) 
 VALUES (c1,c2,n1,n2,n3,p_utente,riga);   

 COMMIT; 
  
END; </pre>	</td></tr>
</table></div>