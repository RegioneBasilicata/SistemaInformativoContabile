<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="../dbdoc.js" type="text/javascript"></script>
<link href="../dbdoc.css" type="text/css" rel="stylesheet">
</head>
<body class="object">
<div id="header"><h2>EQUILIBRI_RENDICONTO_OLD</h2>
<div class="tabs clearfix">

<div class="tab"><div><a href="EQUILIBRI_RENDICONTO_OLD.html">Details</a></div></div>
<div class="tab"><div><a href="EQUILIBRI_RENDICONTO_OLD_Grants.html">Grants</a></div></div>
<div class="tab"><div><a href="EQUILIBRI_RENDICONTO_OLD_References.html">References</a></div></div>
<div class="tab"><div><a href="EQUILIBRI_RENDICONTO_OLD_Dependencies.html">Dependencies</a></div></div>
<div class="tab" id="current"><div><a href="EQUILIBRI_RENDICONTO_OLD_Code.html">Code</a></div></div>
</div></div><br/>
<div class="tab-panes">
<div id="Code"> <table cellpadding="0" cellspacing="0" cellspacing="0" summary=""><tr>
	<th>TEXT</th>
</tr>
	<tr><td><pre>
procedure      EQUILIBRI_RENDICONTO_OLD (p_anno in number,p_utente in varchar2,p_id_report in number) as
 
 riga number :=0;
 c1 VARCHAR2(1000); --descrizione voce
 c2 VARCHAR2(100); -- segno (+)/(-)
 c3 VARCHAR2(100); -- desc colonna importi
 c4 VARCHAR2(1); -- per Evidenziare la riga corrispondente nel report
 c5 VARCHAR2(1000); --TAG BDAP

 n1 NUMBER := 0; -- per colonna "Accertamenti/Impegni"
 nx number := 0; -- per valori di appoggio

 A_eq number := 0; -- A) Equilibrio di parte corrente
 B_eq number := 0; -- B) Equilibrio di parte capitale
 C_eq number := 0; -- C) Variazioni attività finanziaria
 D1_eq number := 0; -- Equilibrio di parte corrente ai fini della copertura degli investimenti plurien.
 D2_eq number := 0; -- Equilibrio di parte corrente ai fini della copertura degli investimenti plurien.

 v1 NUMBER := 0; -- utilizzato come appoggio
 v2 NUMBER := 0; -- utilizzato come appoggio
 v3 NUMBER := 0; -- utilizzato come appoggio
 v4 NUMBER := 0; -- utilizzato come appoggio
 v5 NUMBER := 0; -- utilizzato come appoggio
 v6 NUMBER := 0; -- utilizzato come appoggio

 i number := 0; --contatore generico
 imp_man number := 0; --utilizzato per la quota da inserire extracontabilmente 
 utilizzo_av_corr number := 0; ----utilizzato per inserire la quota di Utilizzo risultato di amministrazione destinato al finanziamento delle spese correnti e al rimborso di prestiti
 fpv_e_corrente number := 0; --utilizzato per inserire la quota di FPV entrate di parte corrente
 fpv_e_capitale number := 0; --utilizzato per inserire la quota di FPV entrate di parte capitale
 fpv_u_corrente number := 0; --utilizzato per inserire la quota di FPV uscite di parte corrente
 fpv_u_capitale number := 0; --utilizzato per inserire la quota di FPV uscite di parte capitale

 fpv_e_corr_libero number := 0; --utilizzato per inserire la quota di FPV entrate di parte corrente NON VINCOLATA
 fpv_u_corr_libero number := 0; --utilizzato per inserire la quota di FPV uscite di parte corrente NON VINCOLATA

 vdata_elaborazione date;
 p_anno1 number(4);
 p_anno2 number(4);

 capitolo_entrata varchar2(6);
 impegnato_vinc number := 0;
 impegnato_vinc_ver number := 0;
 impegnato_mutui number := 0;
 impegnato_vinc1 number := 0;
 impegnato_vinc2 number := 0;
 impegnato_fpv number := 0;


 capitolo_uscita varchar2(6);

 cursor e_vinc is
 select TIPO_CAPITOLO||capitolo capitolo
 ,nvl(ACCERTAMENTI_IMPEGNI_COMPE,0) ACCERTATO
 ,note_sanita
 from fin_t_consuntivo_excel
 where ANNO_CONSUNTIVO = p_anno
 and UTENTE = p_utente
 and TIPO_CAPITOLO = 'E'
 and nvl(nb_entrata_ricorrente,'N') = 'N'
 and note_sanita is not null;

 cursor u_vinc is
 select tipo_capitolo||capitolo capitolo
 ,nvl(avanzo_vincolato,0) avanzo_vincolato,nvl(mutui,0) mutui
   from fin_t_consuntivo_excel u
   where u.ANNO_CONSUNTIVO = p_anno
   and u.UTENTE = p_utente
   and u.TIPO_CAPITOLO = 'U'
   and instr(u.note_sanita,capitolo_entrata) > 0;


-- Vale a partire dal rendiconto 2016.

BEGIN

 DELETE fin_t_rendiconto_equilibri 
 WHERE utente = p_utente AND anno = p_anno;--inserimento colonna Anno 30-09-2019 Gerry
 COMMIT;



-- *** li commento perchè tanto prima di lanciare gli allegati va lanciato il consuntivo *******
-- consuntivo_entrate(p_anno,null,to_date('3112'||p_anno,'ddmmyyyy'),p_utente);
-- consuntivo_uscite(p_anno,null,to_date('3112'||p_anno,'ddmmyyyy'),p_utente);

 select nvl(sum(nvl(fpv,0)),0) into fpv_u_corrente
 from fin_t_consuntivo_excel
 where ANNO_CONSUNTIVO = p_anno
 and UTENTE = p_utente
 and TIPO_CAPITOLO = 'U'
 and NB_TITOLO = '1';

 select nvl(sum(nvl(fpv,0)),0) into fpv_u_capitale
 from fin_t_consuntivo_excel
 where ANNO_CONSUNTIVO = p_anno
 and UTENTE = p_utente
 and TIPO_CAPITOLO = 'U'
 and NB_TITOLO = '2';


 -- riga 1 intestazione principale 

 riga := 1;
 c1 := 'EQUILIBRI DI BILANCIO';
 c2 := '';
 c3 := 'COMPETENZA (ACCERTAMENTI E IMPEGNI IMPUTATI ALL''ESERCIZIO)';


  INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car03,utente,num_ord_riga,anno) 
  VALUES (c1,c2,c3,p_utente,riga,p_anno);  
  commit;


-- riga 2 Utilizzo risultato di amministrazione
 riga := 2;
 c1 := 'Utilizzo risultato di amministrazione destinato al finanziamento delle spese correnti e al rimborso di prestiti';
 c2 := '(+)';
 c5 := 'EQREG-COR_UtilizzoRisultatoAmmFinanzSpeseCorrenti';-- riga TAG BDAP
 n1 := 0; -- importo manuale??

      select nvl(sum(avanzo_vincolato),0) into n1
      from fin_t_consuntivo_excel
      where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = 1
      and nvl(AVANZO_VINCOLATO,0) > 0;

 utilizzo_av_corr := n1;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);   
 commit;

 A_eq := A_eq + n1;

-- riga 3 Ripiano disavanzo di amministrazione
 riga := 3;
 c1 := 'Ripiano disavanzo  di amministrazione esercizio precedente';
 c2 := '(-)';
 c5 := 'EQREG-COR_RipianoDisavanzoAmmEsercizioPrecedente';-- riga TAG BDAP
 n1 := 0;

      select nvl(disavanzo_amministrazione,0)
      into n1
      from fin_t_dati_generali
      where anno_finanziario = p_anno;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);   
 commit;

 A_eq := A_eq - n1;

-- riga 4 FPV corrente Entrata
 riga := 4;
 c1 := 'Fondo pluriennale vincolato per spese correnti iscritto in entrata ';
 c2 := '(+)';
 c5 := 'EQREG-COR_FPVSpeseCorrentiIscrittoEntrata';-- riga TAG BDAP
 n1 := 0;


    select 
    NVL(SUM(nvl(FPV_FONTE,0)),0)
    into fpv_e_corrente
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '1';

      n1 := fpv_e_corrente;

  INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
 commit;

 A_eq := A_eq + n1;

-- riga 5 Entrate 1,2,3
 riga := 5;
 c1 := 'Entrate titoli 1-2-3';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateTitoli1-2-3';-- riga TAG BDAP
 n1 := 0;

    select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO1,1,1) in ('1','2','3');

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq + n1;

-- riga 6 Entrate in conto capitale per contributi agli investimenti
 riga := 6;
 c1 := 'Entrate in conto capitale per Contributi agli investimenti direttamente destinati al rimborso dei prestiti da amministrazioni pubbliche';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateCCapitaleContribInvestRimborsoPrestitiPA';-- riga TAG BDAP
 n1 := 0;

    select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and NB_LIVELLO3 = '4020600';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq + n1;

-- riga 7 Entrate Titolo  4.03   - Altri trasferimenti in conto capitale
 riga := 7;
 c1 := 'Entrate Titolo  4.03   - Altri trasferimenti in conto capitale';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateTitolo4.03';-- riga TAG BDAP
 n1 := 0;

 select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO2,1,3) = '403';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq + n1;

-- riga 8 Entrate in c/capitale destinate all'estinzione anticipata di prestiti
 riga := 8;
 c1 := 'Entrate in c/capitale destinate all''estinzione anticipata di prestiti';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateCCapitaleEAP';-- riga TAG BDAP
 n1 := 0;


  select 
    NVL(SUM(nvl(document_amount,0)),0)
    into n1
    from fin_t_documenti
    where segment8 = p_anno
      and doc_type = 'ACC'
      and nvl(deletion_status_flag,'N') = 'N'
      and substr(attribute16,1,9) = 'E.4.02.06';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq + n1;

-- riga 9 Entrate per accensioni di prestiti destinate all'estinzione anticipata di prestiti
 riga := 9;
 c1 := 'Entrate per accensioni di prestiti destinate all''estinzione anticipata di prestiti';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateAccensPrestitiEAP';-- riga TAG BDAP
 n1 := 0;


 -- ricavo n1 da fnd_reports_importi_man
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_9'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq + n1;

-- riga 10 Entrate di parte capitale destinate a spese correnti in base a specifiche disposizioni di legge o  dei principi contabili
 riga := 10;
 c1 := 'Entrate di parte capitale destinate a spese correnti in base a specifiche disposizioni di legge o  dei principi contabili';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateParteCapitaleDestinateSpeseCorrenti';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_10'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq + n1;

-- riga 11 Spese Correnti
 riga := 11;
 c1 := 'Spese correnti';
 c2 := '(-)';
 c5 := 'EQREG-COR_SpeseCorrenti';-- riga TAG BDAP
 n1 := 0;


  select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '1';

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq - n1;

-- riga 12 Fondo pluriennale vincolato di parte corrente (di spesa)
 riga := 12;
 c1 := 'Fondo pluriennale vincolato di parte corrente (di spesa)';
 c2 := '(-)';
 c5 := 'EQREG-COR_SpeseCorrentiFPV';-- riga TAG BDAP
 n1 := fpv_u_corrente;


 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq - n1;

-- riga 13 Spese Titolo 2.04 -  Altri trasferimenti in conto capitale
 riga := 13;
 c1 := 'Spese Titolo 2.04 -  Altri trasferimenti in conto capitale';
 c2 := '(-)';
 c5 := 'EQREG-COR_SpeseTitolo2.04';-- riga TAG BDAP
 n1 := 0;


 select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and nb_macroaggregato = '204';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq - n1;

 -- ************************************
 -- riga 14 la inseriamo dopo la riga 43
 -- ************************************




 -- riga 15 Rimborso prestiti
 riga := 15;
 c1 := 'Rimborso prestiti';
 c2 := '(-)';
 c5 := 'EQREG-COR_RimborsoPrestiti';-- riga TAG BDAP
 n1 := 0;


 select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '4';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq - n1;

 -- riga 16 - di cui  Fondo anticipazioni di liquidità (DL 35/2013 e successive modifiche e rifinanziamenti) 
 riga := 16;
 c1 := '- di cui  Fondo anticipazioni di liquidità (DL 35/2013 e successive modifiche e rifinanziamenti) ';
 c2 := '';
 c5 := 'EQREG-COR_RimborsoPrestitiFAL';-- riga TAG BDAP
 n1 := 0;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;


-- riga 17 - di cui per estinzione anticipata di prestiti 
 riga := 17;
 c1 := '- di cui per estinzione anticipata di prestiti';
 c2 := '';
 c5 := 'EQREG-COR_RimborsoPrestitiEAP';-- riga TAG BDAP
 n1 := 0;


 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

-- ***************************************
-- riga 18 inserita dopo la 41 e la 14
-- ***************************************


-- riga 19 Utilizzo risultato di amministrazione  per il finanziamento di spese dinvestimento
 riga := 19;
 c1 := 'Utilizzo risultato di amministrazione  per il finanziamento di spese di investimento';
 c2 := '(+)';
 c5 := 'EQREG-CAP_UtilizzoRisultatoAmmFinanzSpeseInvestimento';-- riga TAG BDAP
 n1 := 0;

      select nvl(sum(avanzo_vincolato),0) into n1
      from fin_t_consuntivo_excel
      where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = 2
      and nvl(AVANZO_VINCOLATO,0) > 0;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq + n1;


-- riga 20 Fondo pluriennale vincolato per spese in conto capitale iscritto in entrata
 riga := 20;
 c1 := 'Fondo pluriennale vincolato per spese in conto capitale iscritto in entrata';
 c2 := '(+)';
 c5 := 'EQREG-CAP_FPVSpeseCCapitaleIscrittoEntrata';-- riga TAG BDAP
 n1 := 0;

 select 
    NVL(SUM(nvl(FPV_FONTE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
  INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
      and UTENTE = p_utente
      and NB_TITOLO = '2';

 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
 commit;

 B_eq := B_eq + n1;

 -- riga 21 Entrate in conto capitale (Titolo 4)
 riga := 21;
 c1 := 'Entrate in conto capitale (Titolo 4)';
 c2 := '(+)';
 c5 := 'EQREG-CAP_EntrateContoCapitale';-- riga TAG BDAP
 n1 := 0;


select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO1,1,1) = '4';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq + n1;

-- riga 22 Entrate Titolo 5.01.01 -  Alienazioni  di partecipazioni 
riga := 22;
 c1 := 'Entrate Titolo 5.01.01 -  Alienazioni  di partecipazioni';
 c2 := '(+)';
 c5 := 'EQREG-CAP_EntrateTitolo5.01.01';-- riga TAG BDAP
 n1 := 0;


 select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO3,1,5) = '50101';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq + n1;


-- riga 23 Entrate per accensioni di prestiti (titolo 6)
 riga := 23;
 c1 := 'Entrate per accensioni di prestiti (titolo 6)';
 c2 := '(+)';
 c5 := 'EQREG-CAP_EntrateAccensioniPrestiti';-- riga TAG BDAP
 n1 := 0;


select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO1,1,1) = '6';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq + n1;

-- riga 24 Entrate in conto capitale per Contributi agli investimenti direttamente destinati al rimborso dei prestiti da amministrazioni pubbliche (2)
 riga := 24;
 c1 := 'Entrate in conto capitale per Contributi agli investimenti direttamente destinati al rimborso dei prestiti da amministrazioni pubbliche (2)';
 c2 := '(-)';
 c5 := 'EQREG-CAP_EntrateCCapitaleContribInvestRimborsoPrestitiPA';-- riga TAG BDAP
 n1 := 0;


 -- ricavo n1 da fnd_reports_importi_man
 -- *** coincide con il valore della riga 6 ****
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_6'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq - n1;


-- riga 25 Entrate in c/capitale destinate all'estinzione anticipata di prestiti
 riga := 25;
 c1 := 'Entrate in c/capitale destinate all''estinzione anticipata di prestiti';
 c2 := '(-)';
 c5 := 'EQREG-CAP_EntrateCCapitaleEAP';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
 -- *** coincide con il valore della riga 8 ****
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_8'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq - n1;

-- riga 26 Entrate di parte capitale destinate a spese correnti in base a specifiche disposizioni di legge o  dei principi contabili
 riga := 26;
 c1 := 'Entrate di parte capitale destinate a spese correnti in base a specifiche disposizioni di legge o  dei principi contabili';
 c2 := '(-)';
 c5 := 'EQREG-CAP_EntrateParteCapitaleDestinateSpeseCorrenti';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
 -- *** coincide con il valore della riga 10 ****
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_10'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq - n1;

-- riga 27 Entrate per accensioni di prestiti destinate all'estinzione anticipata di prestiti
 riga := 27;
 c1 := 'Entrate per accensioni di prestiti destinate all''estinzione anticipata di prestiti';

 c2 := '(-)';
 c5 := 'EQREG-CAP_EntrateAccensPrestitiEAP';-- riga TAG BDAP
 n1 := 0;

-- ricavo n1 da fnd_reports_importi_man
 -- *** coincide con il valore della riga 9 ****
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_9'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq - n1;


-- riga 28 Entrate Titolo  4.03   - Altri trasferimenti in conto capitale
 riga := 28;
 c1 := 'Entrate Titolo  4.03   - Altri trasferimenti in conto capitale';
 c2 := '(-)';
 c5 := 'EQREG-CAP_EntrateTitolo4.03';-- riga TAG BDAP
 n1 := 0;

 select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO2,1,3) = '403';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq - n1;

 -- riga 29 Spese in conto capitale
 riga := 29;
 c1 := 'Spese in conto capitale';
 c2 := '(-)';
 c5 := 'EQREG-CAP_SpeseContoCapitale';-- riga TAG BDAP
 n1 := 0;


select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '2';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq - n1;

-- riga 30 Fondo pluriennale vincolato di parte capital (di spesa)
 riga := 30;
 c1 := 'Fondo pluriennale vincolato in c/capitale (di spesa)';
 c2 := '(-)';
 c5 := 'EQREG-CAP_SpeseContoCapitaleFPV';-- riga TAG BDAP
 n1 := fpv_u_capitale;


 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq - n1;

-- riga 31 Spese Titolo 2.04 -  Altri trasferimenti in conto capitale
 riga := 31;
 c1 := 'Spese Titolo 2.04 -  Altri trasferimenti in conto capitale';
 c2 := '(+)';
 c5 := 'EQREG-CAP_SpeseTitolo2.04';-- riga TAG BDAP
 n1 := 0;


 select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and nb_macroaggregato = '204';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq + n1;

-- riga 32 Spese Titolo 3.01.01 - Acquisizioni di partecipazioni e conferimenti di capitale 
riga := 32;
 c1 := 'Spese Titolo 3.01.01 - Acquisizioni di partecipazioni e conferimenti di capitale ';
 c2 := '(-)';
 c5 := 'EQREG-CAP_SpeseTitolo3.01.01';-- riga TAG BDAP
 n1 := 0;


 select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and substr(nb_piano_conti_fina,3,7) = '3.01.01';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq - n1;

-- riga 33 Disavanzo pregresso derivante da debito autorizzato e non contratto 
 riga := 33;
 c1 := 'Disavanzo pregresso derivante da debito autorizzato e non contratto ';
 c2 := '(-)';
 c5 := 'EQREG-CAP_DisavanzoPregressoDebitoAutorizzatoNonContratto';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_33'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq - n1;


-- ****************************************
-- Righe 34 e 35 inserite dopo la riga 41
-- ****************************************


-- riga 36 Utilizzo risultato di amministrazione per  l'incremento di  attività finanziarie 
 riga := 36;
 c1 := 'Utilizzo risultato di amministrazione per  l''incremento di  attività finanziarie';
 c2 := '(+)';
 c5 := 'EQREG-VAR_UtilizzoRisultatoAmmFinanzAttivitaFinanziarie';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
   from fnd_reports_importi_man
  begin 
   select nvl(importo,0)
   into n1
   where nome_campo_report = 'XXX_36'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

C_eq := C_eq + n1;

-- riga 37 Entrate titolo 5.00  -  Riduzioni attività finanziarie 
 riga := 37;
 c1 := 'Entrate titolo 5.00  -  Riduzioni attività finanziarie ';
 c2 := '(+)';
 c5 := 'EQREG-VAR_EntrateTitolo5.00';-- riga TAG BDAP
 n1 := 0;

 select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO1,1,1) = '5';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

C_eq := C_eq + n1;

 -- riga 38 Spese titolo 3.00 - Incremento attività finanziarie
 riga := 38;
 c1 := 'Spese titolo 3.00 - Incremento attività finanziarie';
 c2 := '(-)';
 c5 := 'EQREG-VAR_SpeseTitolo3.00';-- riga TAG BDAP
 n1 := 0;


select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '3';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

C_eq := C_eq - n1;


-- riga 39 Entrate Titolo 5.01.01 -  Alienazioni  di partecipazioni 
riga := 39;
 c1 := 'Entrate Titolo 5.01.01 -  Alienazioni  di partecipazioni';
 c2 := '(-)';
 c5 := 'EQREG-VAR_EntrateTitolo5.01.01';-- riga TAG BDAP
 n1 := 0;


 select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO3,1,5) = '50101';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

C_eq := C_eq - n1;

-- riga 40 Spese Titolo 3.01.01 - Acquisizioni di partecipazioni e conferimenti di capitale 
riga := 40;
 c1 := 'Spese Titolo 3.01.01 - Acquisizioni di partecipazioni e conferimenti di capitale ';
 c2 := '(+)';
 c5 := 'EQREG-VAR_SpeseTitolo3.01.01';-- riga TAG BDAP
 n1 := 0;


 select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and substr(nb_piano_conti_fina,3,7) = '3.01.01';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
C_eq := C_eq + n1;
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;



-- riga 41 A) C) Variazioni attività finanziaria
 riga := 41;
 c1 := 'C) Variazioni attivita'' finanziaria';
 c2 := '';
 c4 := 'E';
 c5 := 'EQREG-VAR_VariazioniAttivitaFinanziaria'; --riga TAG BDAP
 n1 := C_eq;



INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car04,car05,num01,utente,num_ord_riga,anno) 
VALUES (c1,c2,c4,c5,n1,p_utente,riga,p_anno);  
commit;


-- ****** da inserire dopo la riga 41 Variazioni di attività finanziarie V_eq
-- riga 14 Variazioni di attività finanziarie (se negativo) 
 riga := 14;
 c1 := 'Variazioni di attività finanziarie (se negativo)';
 c2 := '(-)';
 c5 := 'EQREG-COR_VariazioniAttivitaFinanziarieNegativo';-- riga TAG BDAP
 n1 := 0;

  if C_eq &lt; 0
  then n1 := C_eq;
  end if;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

A_eq := A_eq - n1;

-- riga 18 A) Equilibrio di parte corrente
 riga := 18;
 c1 := 'A) Equilibrio di parte corrente';
 c2 := '';
 c4 := 'E';
 c5 := 'EQREG-COR_EquilibrioParteCorrente';-- riga TAG BDAP
 n1 := A_eq;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car04,car05,num01,utente,num_ord_riga,anno) 
VALUES (c1,c2,c4,c5,n1,p_utente,riga,p_anno);  
commit;

-- riga 34 Variazioni di attività finanziarie (se positivo) 
 riga := 34;
 c1 := 'Variazioni di attività finanziarie (se positivo)';
 c2 := '(+)';
 c5 := 'EQREG-CAP_VariazioniAttivitaFinanziariePositivo';-- riga TAG BDAP
 n1 := 0;

  if C_eq > 0
  then n1 := C_eq;
  end if;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

B_eq := B_eq + n1;

-- riga 35 B) Equilibrio di parte capitale
 riga := 35;
 c1 := 'B) Equilibrio di parte capitale';
 c2 := '';
 c4 := 'E';
 c5 := 'EQREG-CAP_EquilibrioParteCapitale';-- riga TAG BDAP
 n1 := B_eq;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car04,car05,num01,utente,num_ord_riga,anno) 
VALUES (c1,c2,c4,c5,n1,p_utente,riga,p_anno);  
commit;


-- riga 42 EQUILIBRIO FINALE (D=A+B)
 riga := 42;
 c1 := 'EQUILIBRIO FINALE (D=A+B)';
 c2 := '';
 c5 := 'EQREG_EquilibrioFinale';-- riga TAG BDAP
 n1 := A_eq + B_eq;


INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

-- riga 43 Saldo corrente ai fini della copertura degli investimenti pluriennali delle Regioni  a statuto ordinario
 riga := 43;
 c1 := 'Saldo corrente ai fini della copertura degli investimenti pluriennali delle Regioni  a statuto ordinario';
 c2 := '';


INSERT INTO fin_t_rendiconto_equilibri (car01,car02,utente,num_ord_riga,anno) 
VALUES (c1,c2,p_utente,riga,p_anno);  
commit;

-- riga 44 A) Equilibrio di parte corrente
 riga := 44;
 c1 := 'A) Equilibrio di parte corrente';
 c2 := '';
 c5 := 'EQREG-SAL_EquilibrioParteCorrente';-- riga TAG BDAP
 n1 := A_eq;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);  
commit;

D1_eq := D1_eq + n1;


-- riga 45 Utilizzo risultato di amministrazione
 riga := 45;
 c1 := 'Utilizzo risultato di amministrazione destinato al finanziamento delle spese correnti e al rimborso di prestiti';
 c2 := '(-)';
 c5 := 'EQREG-SAL_UtilizzoRisultatoAmmFinanzSpeseCorrenti';-- riga TAG BDAP
 n1 := 0; -- importo manuale??

     -- *** coincide con il valore della riga2

     /* select nvl(sum(nvl(importo,0)),0)
      into n1
      from fnd_reports_importi_man
      where valore_parametro_anno = p_anno
      and nome_campo_report = 'RIGA45'
      and id_report = p_id_report;*/

      n1 := utilizzo_av_corr;
 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);   
 commit;

D1_eq := D1_eq - n1;


-- riga 46 Entrate non ricorrenti che non hanno dato copertura a impegni
 riga := 46;
 c1 := 'Entrate non ricorrenti che non hanno dato copertura a impegni';
 c2 := '(-)';
 c5 := 'EQREG-SAL_EntrateNonRicorrentiNoCoperturaImpegni';-- riga TAG BDAP
 n1 := 0;

-- si considerano i capitoli di entrata non ricorrente vincolati???
-- commentato perchè al momento il dato va calcolato extra contabilmente
/*delete  tmp_appoggio where utente = p_utente and num_ord_riga = riga;

for e in e_vinc loop

    capitolo_entrata := e.capitolo;

 for u in u_vinc loop
   select nvl(sum(nvl(document_amount,0)),0) into impegnato_vinc1
    from fin_t_documenti
    where segment8 = p_anno
    and doc_type like 'IMP%'
    and nvl(DELETION_STATUS_FLAG,'N') = 'N'
    and attribute23 is null
    and segment2 = u.capitolo;

    and r.capitolo = u.capitolo;
    select nvl(sum(nvl(r.da_fpv,0)),0) into impegnato_fpv
    from fin_t_riaccertamenti r
    where r.anno_bilancio_riaccertamento = p_anno +1 

    select nvl(sum(nvl(quota_vincolata,0)),0) into impegnato_vinc2
    from vw_vincoli_definitivi
    where anno = p_anno
    and eu||capitolo_entrata = e.capitolo
    and capitolo_uscita = u.capitolo;


    if impegnato_vinc2 &lt; 0
    then impegnato_vinc2 := 0;
    end if;

    if (impegnato_vinc1 - (u.avanzo_vincolato+impegnato_vinc2+u.mutui)) > 0 
     then impegnato_vinc := impegnato_vinc + (u.avanzo_vincolato+impegnato_vinc2+u.mutui);
     impegnato_vinc_ver := (u.avanzo_vincolato+impegnato_vinc2+u.mutui);
     else impegnato_vinc := impegnato_vinc + impegnato_vinc1 + impegnato_fpv;
     impegnato_vinc_ver := impegnato_vinc1 + impegnato_fpv;
    end if;


  INSERT INTO tmp_appoggio (car01,car02,num01,num02,num03,num04,num05,num06,NUM07,utente,num_ord_riga) --,num03,num04,num05,
  VALUES (e.capitolo,u.capitolo,e.accertato,impegnato_vinc1,u.avanzo_vincolato,impegnato_vinc2,impegnato_fpv,u.mutui,impegnato_vinc_ver,p_utente,riga);   --u.capitolo,impegnato_vinc1,u.avanzo_vincolato,impegnato_vinc2,impegnato_fpv
  commit;
  impegnato_vinc_ver := 0;
 end loop;



  if (e.ACCERTATO - impegnato_vinc) > 0
  then
   n1 := n1 + (e.ACCERTATO - impegnato_vinc);
  end if;
   impegnato_vinc := 0;
  end loop;
*/

 select nvl(sum(nvl(importo,0)),0)
      into n1
      from fnd_reports_importi_man
      where valore_parametro_anno = p_anno
      and nome_campo_report = 'RIGA46'
      and id_report = p_id_report;

    INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);   
 commit;

D1_eq := D1_eq - n1;

-- riga 47 Fondo pluriennale vincolato per spese correnti iscritto in entrata al netto delle componenti non vincolate derivanti dal riaccertamento ord.
 riga := 47;
 c1 := 'Fondo pluriennale vincolato per spese correnti iscritto in entrata al netto delle componenti non vincolate derivanti dal riaccertamento ord.';
 c2 := '(-)';
 c5 := 'EQREG-SAL_FPVSpeseCorrentiIscrittoEntrata';-- riga TAG BDAP
 n1 := 0;

/* select nvl(sum(nvl(importo,0)),0)
      into n1
      from fnd_reports_importi_man
      where valore_parametro_anno = p_anno
      and nome_campo_report = 'RIGA47'
      and id_report = p_id_report;
*/

      /*  select sum(nvl(f.col_a,0)) into fpv_e_corr_libero
        from fin_t_rendiconto_fpv f
        ,fin_t_consuntivo_excel c
        where f.anno = p_anno
        and (nvl(f.col_a,0)) > 0
        and f.utente = p_utente
        and c.anno_consuntivo = f.anno
        and c.utente = f.utente
        and c.tipo_capitolo||c.capitolo = f.capitolo
        and nvl(c.entrate_libere,0) > 0
        and c.nb_titolo = '1';
*/

        select sum(nvl(c.fpv_fonte,0)) into fpv_e_corr_libero
        from fin_t_consuntivo_excel c
        where c.anno_consuntivo = p_anno
        and c.utente = p_utente
        and c.tipo_capitolo = 'U'
        and nvl(c.fpv_fonte,0) > 0
        and nvl(c.entrate_libere,0) > 0
        and c.nb_titolo = '1';

    n1 := fpv_e_corrente - fpv_e_corr_libero;
 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);   
 commit;

D1_eq := D1_eq - n1;

-- riga 48 Entrate titoli 1-2-3  non sanitarie con specifico vincolo di destinazione
 riga := 48;
 c1 := 'Entrate titoli 1-2-3  non sanitarie con specifico vincolo di destinazione';
 c2 := '(-)';
 c5 := 'EQREG-SAL_EntrateTitoli1-2-3NonSanitarie';-- riga TAG BDAP
 n1 := 0;
 imp_man := 0;

-- si considerano i capitoli di entrata non ricorrente non vincolati???
-- al momento viene calcolato extra contabilmente
  select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
    and TIPO_CAPITOLO = 'E'
    and UTENTE = p_utente
    and substr(nb_livello1,1,1) in ('1','2','3')
    and nvl(SANITA_SN,'N') = 'N'
    and note_sanita is not null;


  select nvl(sum(nvl(importo,0)),0)
      into imp_man
      from fnd_reports_importi_man
      where valore_parametro_anno = p_anno
      and nome_campo_report = 'RIGA48'
      and id_report = p_id_report;

n1 :=  n1 + imp_man;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);   
 commit;

D1_eq := D1_eq - n1;

-- riga 49 Entrate titoli 1-2-3 destinate al finanziamento del SSN
 riga := 49;
 c1 := 'Entrate titoli 1-2-3 destinate al finanziamento del SSN';
 c2 := '(-)';
 c5 := 'EQREG-SAL_EntrateTitoli1-2-3FinanzSSN';-- riga TAG BDAP
 n1 := 0;

-- si considerano i capitoli di entrata non ricorrente non vincolati???
 /* select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
    and TIPO_CAPITOLO = 'E'
    and UTENTE = p_utente
    and substr(nb_livello1,1,1) in ('1','2','3')
   -- prendiamo le Uscite su indicazione SARLI 01/08/2017 in quanto un particolare capitolo di Entrata pur non avendo un vincolo diretto è da considerarsi a finanziamento SSN
    and nvl(SANITA_SN,'N') = 'S';*/

   --- considerarele Entrate (non vincolate) che finanziano UScite Correnti sanità con entrate_libere o fpv_fonte > 0

    select NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
    and TIPO_CAPITOLO = 'U'
    and UTENTE = p_utente
    and nb_titolo = '1'
    and nvl(SANITA_SN,'N') = 'S'
    and (note_sanita is not null or (nvl(entrate_libere,0) + nvl(fpv_fonte,0)+nvl(avanzo_vincolato,0)) > 0);



 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);   
 commit;

D1_eq := D1_eq - n1;

-- riga 50 Spese correnti non sanitarie finanziate da entrate con specifico vincolo di destinazione
 riga := 50;
 c1 := 'Spese correnti non sanitarie finanziate da entrate con specifico vincolo di destinazione';
 c2 := '(+)';
 c5 := 'EQREG-SAL_SpeseCorrentiNonSanitarieFinanzEntrateVincoloDest';-- riga TAG BDAP
 n1 := 0;
 imp_man := 0;
-- si considerano i capitoli di entrata non ricorrente non vincolati???
-- al momento viene calcolato extra contabilmente

  select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
    and TIPO_CAPITOLO = 'U'
    and UTENTE = p_utente
    and NB_TITOLO = '1'
    and nvl(SANITA_SN,'N') = 'N'
    and (note_sanita is not null or nvl(FPV_FONTE,0) > 0);

 select nvl(sum(nvl(importo,0)),0)
      into imp_man
      from fnd_reports_importi_man
      where valore_parametro_anno = p_anno
      and nome_campo_report = 'RIGA50'
      and id_report = p_id_report;

n1 := n1 + imp_man;
 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);   
 commit;

D1_eq := D1_eq + n1;

-- riga 51 Fondo pluriennale vincolato di parte corrente (di spesa) al netto delle componenti non vincolate derivanti dal riaccertamento ord.
 riga := 51;
 c1 := 'Fondo pluriennale vincolato di parte corrente (di spesa) al netto delle componenti non vincolate derivanti dal riaccertamento ord.';
 c2 := '(+)';
 c5 := 'EQREG-SAL_FPVParteCorrenteNettoComponentiNonVincolate';-- riga TAG BDAP
 n1 := 0;

 /*select sum(nvl(f.col_g,0)) into fpv_u_corr_libero
        from fin_t_rendiconto_fpv f
        ,fin_t_consuntivo_excel c
        where f.anno = p_anno
        and (nvl(f.col_g,0)) > 0
        and f.utente = p_utente
        and c.anno_consuntivo = f.anno
        and c.utente = f.utente
        and c.tipo_capitolo||c.capitolo = f.capitolo
        and nvl(c.entrate_libere,0) > 0
        and c.nb_titolo = '1';
   */ 

   select sum(nvl(c.fpv,0)) into fpv_u_corr_libero
        from fin_t_consuntivo_excel c
        where c.anno_consuntivo = p_anno
        and c.utente = p_utente
        and c.tipo_capitolo = 'U'
        and nvl(c.entrate_libere,0) > 0
        and nvl(c.fpv,0) > 0
        and c.nb_titolo = '1';
    n1 := fpv_u_corrente - fpv_u_corr_libero;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);   
 commit;

D1_eq := D1_eq + n1;

 c2 := '(+)';
-- riga 52 Spese correnti finanziate da entrate destinate al SSN
 riga := 52;
 c1 := 'Spese correnti finanziate da entrate destinate al SSN';
 c5 := 'EQREG-SAL_SpeseCorrentiFinanzEntrateSSN';-- riga TAG BDAP
 n1 := 0;

    select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
    and TIPO_CAPITOLO = 'U'
    and UTENTE = p_utente
    and NB_TITOLO = '1'
    and nvl(SANITA_SN,'N') = 'S'
    and  (note_sanita is not null or (nvl(entrate_libere,0) + nvl(fpv_fonte,0)+nvl(avanzo_vincolato,0)) > 0);

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno);   
 commit;

D1_eq := D1_eq + n1;

-- riga 53 Equilibrio di parte corrente ai fini della copertura degli investimenti pluriennali
 riga := 53;
 c1 := 'Equilibrio di parte corrente ai fini della copertura degli investimenti pluriennali';
 c2 := '';
 c4 := 'E';
 c5 := 'EQREG-SAL_EquilibrioParteCorrenteCoperturaInvestPluriennali';-- riga TAG BDAP
 n1 := D1_eq;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car04,car05,num01,utente,num_ord_riga,anno) 
VALUES (c1,c2,c4,c5,n1,p_utente,riga,p_anno);  
commit;

-- ****** VALIDO per AUTONOMIE SPECIALI
/*
-- riga 54 Saldo corrente ai fini della copertura degli investimenti pluriennali delle Autonomie speciali
 riga := 54;
 c1 := 'Saldo corrente ai fini della copertura degli investimenti pluriennali delle Autonomie speciali';
 c2 := '';


INSERT INTO fin_t_rendiconto_equilibri (car01,car02,utente,num_ord_riga) 
VALUES (c1,c2,p_utente,riga);  
commit;

-- riga 55 A) Equilibrio di parte corrente
 riga := 55;
 c1 := 'A) Equilibrio di parte corrente';
 c2 := '';
 n1 := A_eq;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,num01,utente,num_ord_riga) 
VALUES (c1,c2,n1,p_utente,riga);  
commit;

D2_eq := D2_eq + n1;

-- riga 56 Utilizzo risultato di amministrazione
 riga := 56;
 c1 := 'Utilizzo risultato di amministrazione destinato al finanziamento delle spese correnti e al rimborso di prestiti';
 c2 := '(-)';
 n1 := 0; -- importo manuale??

     -- *** coincide con il valore della riga2
      select nvl(sum(nvl(importo,0)),0)
      into n1
      from fnd_reports_importi_man
      where valore_parametro_anno = p_anno
      and nome_campo_report = 'XXX_2'
      and id_report = p_id_report;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,num01,utente,num_ord_riga) 
 VALUES (c1,c2,n1,p_utente,riga);   
 commit;

D2_eq := D2_eq - n1;


-- riga 57 Entrate non ricorrenti che non hanno dato copertura a impegni
 riga := 57;
 c1 := 'Entrate non ricorrenti che non hanno dato copertura a impegni';
 c2 := '(-)';
 n1 := 0;

-- si considerano i capitoli di entrata non ricorrente non vincolati???
select 
    NVL(SUM(nvl(ACCERTAMENTI_IMPEGNI_COMPE,0)),0)
   into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
   and nvl(nb_entrata_ricorrente,'N') = 'N'
   and note_sanita is null;

    INSERT INTO fin_t_rendiconto_equilibri (car01,car02,num01,utente,num_ord_riga) 
 VALUES (c1,c2,n1,p_utente,riga);   
 commit;

D2_eq := D2_eq - n1;

-- riga 58 Equilibrio di parte corrente ai fini della copertura degli investimenti pluriennali
 riga := 58;
 c1 := 'Equilibrio di parte corrente ai fini della copertura degli investimenti pluriennali';
 c2 := '';
 n1 := D2_eq;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,num01,utente,num_ord_riga) 
VALUES (c1,c2,n1,p_utente,riga);  
commit;
*/

 END;</pre>	</td></tr>
</table></div>