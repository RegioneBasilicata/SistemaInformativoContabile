<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="../dbdoc.js" type="text/javascript"></script>
<link href="../dbdoc.css" type="text/css" rel="stylesheet">
</head>
<body class="object">
<div id="header"><h2>FED_FISCALE_U_SETTORI</h2>
<div class="tabs clearfix">

<div class="tab"><div><a href="FED_FISCALE_U_SETTORI.html">Details</a></div></div>
<div class="tab"><div><a href="FED_FISCALE_U_SETTORI_Grants.html">Grants</a></div></div>
<div class="tab"><div><a href="FED_FISCALE_U_SETTORI_References.html">References</a></div></div>
<div class="tab"><div><a href="FED_FISCALE_U_SETTORI_Dependencies.html">Dependencies</a></div></div>
<div class="tab" id="current"><div><a href="FED_FISCALE_U_SETTORI_Code.html">Code</a></div></div>
</div></div><br/>
<div class="tab-panes">
<div id="Code"> <table cellpadding="0" cellspacing="0" cellspacing="0" summary=""><tr>
	<th>TEXT</th>
</tr>
	<tr><td><pre>
PROCEDURE FED_FISCALE_U_SETTORI 
(
  P_ANNO IN NUMBER, P_DATA IN DATE  
) AS 
num_ord number := 2;
type vettore_35 is varray(35) of number(15,2);
colonna vettore_35 := vettore_35(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);
--p_anno number := 2008;
cod_bil_siope varchar2(10);
cod_gest_siope varchar2(10);
k number := 0;
data_mov date := nvl(p_data,to_date('3112'||p_anno,'ddmmyyyy'));

cursor siope is
select anno
,eu
,codice_bil1
,nvl(codice_bil2,0) codice_bil2
,nvl(codice_bil3,0) codice_bil3
,descrizione
,codice_gestionale
,nvl(visibile,'N') visibile
from fin_t_struttura_siope
where anno = p_anno
and eu = 'U'
--and codice_gestionale is null
order by 3,4,5,nvl(codice_gestionale,0);

-- **** cursori per codice_gestionale NOT NULL
cursor settori_imp is
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(d.document_amount,0)) tot_impegni
from fin_t_articoli a,
fin_t_documenti d
where a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and a.codice_bilancio_siope = cod_bil_siope
and a.codice_gestionale_siope = cod_gest_siope
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type like 'IMP%'
and nvl(d.deletion_status_flag,'N') = 'N'
and d.date_created &lt;= data_mov
group by substr(a.codice_meccanografico,9,2)
order by 1;


cursor settori_mand is
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(t.amount,0)) tot_mandati
from fin_t_articoli a,
fin_t_documenti d,
fin_t_documenti_terze_parti t,
fin_t_siope s
where  a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
--and a.codice_bilancio_siope = cod_bil_siope
--and a.codice_gestionale_siope = cod_gest_siope
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type = 'MAND'
and nvl(d.open_balance_proposed,0) > 0
and d.date_created &lt;= data_mov
and t.doc_id = d.doc_id
and t.codice_gestionale_siope = cod_gest_siope
and s.eu = 'U'
and s.codice_gestionale = t.codice_gestionale_siope
and s.codice_bilancio = cod_bil_siope
group by substr(a.codice_meccanografico,9,2)
order by 1;
/*cursor settori_mand is
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(d.open_balance_proposed,0)) tot_mandati
from fin_t_articoli a,
fin_t_documenti d
where  a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and a.codice_bilancio_siope = cod_bil_siope
and a.codice_gestionale_siope = cod_gest_siope
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type = 'MAND'
and d.date_created &lt;= data_mov
group by substr(a.codice_meccanografico,9,2)
order by 1;*/
-- **** FINE cursori per codice_gestionale NOT NULL

-- **** cursori per codice_bil2 > 0 e codice_bil3 > 0 codice_gestionale NULL  "1" 
cursor settori_imp_1 is
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(d.document_amount,0)) tot_impegni
from fin_t_articoli a,
fin_t_documenti d
where a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and a.codice_bilancio_siope = cod_bil_siope -- = nvl(s.codice_bil1,0)||nvl(s.codice_bil2,0)||nvl(s.codice_bil3,0)
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type like 'IMP%'
and nvl(d.deletion_status_flag,'N') = 'N'
and d.date_created &lt;= data_mov
group by substr(a.codice_meccanografico,9,2)
order by 1;

cursor settori_mand_1 is
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(t.amount,0)) tot_mandati
from fin_t_articoli a,
fin_t_documenti d,
fin_t_documenti_terze_parti t,
fin_t_siope s
where  a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type = 'MAND'
and nvl(d.open_balance_proposed,0) > 0
and d.date_created &lt;= data_mov
and t.doc_id = d.doc_id
and s.eu = 'U'
and s.codice_gestionale = t.codice_gestionale_siope
and s.codice_bilancio = cod_bil_siope
group by substr(a.codice_meccanografico,9,2)
order by 1;
/*
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(d.open_balance_proposed,0)) tot_mandati
from fin_t_articoli a,
fin_t_documenti d
where  a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and a.codice_bilancio_siope = cod_bil_siope -- = nvl(s.codice_bil1,0)||nvl(s.codice_bil2,0)||nvl(s.codice_bil3,0)
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type = 'MAND'
and d.date_created &lt;= data_mov
group by substr(a.codice_meccanografico,9,2)
order by 1;*/



-- **** FINE cursori per codice_bil2 > 0 e codice_bil3 > 0 codice_gestionale NULL  "1" 

-- **** cursori per codice_bil2 > 0 e codice_bil3 = 0 codice_gestionale NULL  "2" 
cursor settori_imp_2 is
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(d.document_amount,0)) tot_impegni
from fin_t_articoli a,
fin_t_documenti d
where a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and substr(a.codice_bilancio_siope,1,3) = cod_bil_siope -- = = nvl(s.codice_bil1,0)||nvl(s.codice_bil2,0)
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type like 'IMP%'
and nvl(d.deletion_status_flag,'N') = 'N'
and d.date_created &lt;= data_mov
group by substr(a.codice_meccanografico,9,2)
order by 1;

cursor settori_mand_2 is
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(t.amount,0)) tot_mandati
from fin_t_articoli a,
fin_t_documenti d,
fin_t_documenti_terze_parti t,
fin_t_siope s
where  a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type = 'MAND'
and nvl(d.open_balance_proposed,0) > 0
and d.date_created &lt;= data_mov
and t.doc_id = d.doc_id
and s.eu = 'U'
and s.codice_gestionale = t.codice_gestionale_siope
and substr(s.codice_bilancio,1,3) = cod_bil_siope
group by substr(a.codice_meccanografico,9,2)
order by 1;
/*
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(d.open_balance_proposed,0)) tot_mandati
from fin_t_articoli a,
fin_t_documenti d
where  a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and substr(a.codice_bilancio_siope,1,3) = cod_bil_siope -- = = nvl(s.codice_bil1,0)||nvl(s.codice_bil2,0)
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type = 'MAND'
and d.date_created &lt;= data_mov
group by substr(a.codice_meccanografico,9,2)
order by 1;
*/


-- **** FINE cursori per codice_bil2 > 0 e codice_bil3 = 0 codice_gestionale NULL  "2" 

-- **** cursori per codice_bil2 = 0 codice_gestionale NULL  "3" 
cursor settori_imp_3 is
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(d.document_amount,0)) tot_impegni
from fin_t_articoli a,
fin_t_documenti d
where a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and substr(a.codice_bilancio_siope,1,1) = cod_bil_siope -- = nvl(s.codice_bil1,0)
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type like 'IMP%'
and nvl(d.deletion_status_flag,'N') = 'N'
and d.date_created &lt;= data_mov
group by substr(a.codice_meccanografico,9,2)
order by 1;

cursor settori_mand_3 is
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(t.amount,0)) tot_mandati
from fin_t_articoli a,
fin_t_documenti d,
fin_t_documenti_terze_parti t,
fin_t_siope s
where  a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type = 'MAND'
and nvl(d.open_balance_proposed,0) > 0
and d.date_created &lt;= data_mov
and t.doc_id = d.doc_id
and s.eu = 'U'
and s.codice_gestionale = t.codice_gestionale_siope
and substr(s.codice_bilancio,1,1) = cod_bil_siope
group by substr(a.codice_meccanografico,9,2)
order by 1;
/*
select substr(a.codice_meccanografico,9,2) cod_mecc 
,sum(nvl(d.open_balance_proposed,0)) tot_mandati
from fin_t_articoli a,
fin_t_documenti d
where  a.anno = p_anno
and a.eu = 'U'
and substr(a.codice_meccanografico,9,2) is not null
and substr(a.codice_bilancio_siope,1,1) = cod_bil_siope -- = nvl(s.codice_bil1,0)
and d.segment8 = a.anno
and d.segment2 = a.eu||a.codice
and d.doc_type = 'MAND'
and d.date_created &lt;= data_mov
group by substr(a.codice_meccanografico,9,2)
order by 1;
*/

-- **** FINE cursori per codice_bil2 > 0 e codice_bil3 = 0 codice_gestionale NULL  "2" 

-- **** cursore per Impegni Stanziamenti UE CORRENTI
/*cursor impegni_ue_corr is
select substr(a.codice_meccanografico,9,2) cod_mecc  
,sum(nvl(b.quota_ue_imp,0)) impegni
from fin_t_por_patto b
,fin_t_articoli a 
where b.anno = p_anno
and b.anno = a.anno
and b.capitolo = a.eu||a.codice
and substr(a.codice_meccanografico,3,1) = '1' 
group by substr(a.codice_meccanografico,9,2);*/

cursor impegni_ue_corr is
select 
substr(a.codice_meccanografico,9,2) cod_mecc  
,nvl(round((sum((nvl(b.document_amount,0)*nvl(p.p_anno_cor,0)))),2),0) impegni
      from fin_t_documenti b
      ,fin_t_por_patto p
      ,fin_t_articoli a
      where b.doc_type like 'IMP%'
      and nvl(b.deletion_status_flag,'X') &lt;> 'Y'
      and b.segment8 = p_anno
   --   and b.date_created &lt;= nvl(trunc(data_al,'dd'),b.date_created)
      and p.anno = b.segment8
      and p.capitolo = b.segment2
      and a.anno = b.segment8
      and a.eu||a.codice = b.segment2
      and a.nb_titolo =1
      group by substr(a.codice_meccanografico,9,2);

-- **** FINE cursore per Impegni Stanziamenti UE CORRENTI



--

-- **** cursore per Impegni Stanziamenti UE CAPITALI
/*cursor impegni_ue_cap is
select substr(a.codice_meccanografico,9,2) cod_mecc  
,sum(nvl(b.quota_ue_imp,0)) impegni
from fin_t_por_patto b
,fin_t_articoli a 
where b.anno = p_anno
and b.anno = a.anno
and b.capitolo = a.eu||a.codice
and substr(a.codice_meccanografico,3,1) = '2' 
group by substr(a.codice_meccanografico,9,2);*/

cursor impegni_ue_cap is
select 
substr(a.codice_meccanografico,9,2) cod_mecc  
,nvl(round((sum((nvl(b.document_amount,0)*nvl(p.p_anno_cor,0)))),2),0) impegni
      from fin_t_documenti b
      ,fin_t_por_patto p
      ,fin_t_articoli a
      where b.doc_type like 'IMP%'
      and nvl(b.deletion_status_flag,'X') &lt;> 'Y'
      and b.segment8 = p_anno
   --   and b.date_created &lt;= nvl(trunc(data_al,'dd'),b.date_created)
      and p.anno = b.segment8
      and p.capitolo = b.segment2
      and a.anno = b.segment8
      and a.eu||a.codice = b.segment2
      and a.nb_titolo in (2,3)
      group by substr(a.codice_meccanografico,9,2);

-- **** FINE cursore per Impegni Stanziamenti UE CAPITALI

-- **** cursore per PAGAMENTI Stanziamenti UE CORRENTI
/*cursor mandati_ue_corr is
select substr(a.codice_meccanografico,9,2) cod_mecc  
,nvl(sum(nvl(b.QUOTA_UE_RESIDUO,0) + nvl(QUOTA_UE_COMPE,0)),0) mandati
from fin_t_por_patto b
,fin_t_articoli a 
where b.anno = p_anno
and b.anno = a.anno
and b.capitolo = a.eu||a.codice
and substr(a.codice_meccanografico,3,1) = '1' 
group by substr(a.codice_meccanografico,9,2);*/
-- **** FINE cursore per PAGAMENTI Stanziamenti UE CORRENTI

--
cursor mandati_ue_corr is
select substr(a.codice_meccanografico,9,2) cod_mecc  
,nvl(sum(round(nvl(b.open_balance_proposed,0)*nvl(p.p_anno_cor,0),2)),0) mandati
      from fin_t_documenti b
      ,fin_t_por_patto p
      ,fin_t_articoli a
      where b.doc_type = 'MAND'
      and nvl(b.deletion_status_flag,'X') &lt;> 'Y'
      and b.segment8 = p_anno
   --   and b.date_created &lt;= nvl(trunc(data_al,'dd'),b.date_created)
      and p.anno = b.segment8
      and p.capitolo = b.segment2
      and a.anno = b.segment8
      and a.eu||a.codice = b.segment2
      and a.nb_titolo = 1
     group by substr(a.codice_meccanografico,9,2);
--

-- **** cursore per PAGAMENTI Stanziamenti UE CAPITALI
cursor mandati_ue_cap is
select substr(a.codice_meccanografico,9,2) cod_mecc  
,nvl(sum(round(nvl(b.open_balance_proposed,0)*nvl(p.p_anno_cor,0),2)),0) mandati
      from fin_t_documenti b
      ,fin_t_por_patto p
      ,fin_t_articoli a
      where b.doc_type = 'MAND'
      and nvl(b.deletion_status_flag,'X') &lt;> 'Y'
      and b.segment8 = p_anno
   --   and b.date_created &lt;= nvl(trunc(data_al,'dd'),b.date_created)
      and p.anno = b.segment8
      and p.capitolo = b.segment2
      and a.anno = b.segment8
      and a.eu||a.codice = b.segment2
      and a.nb_titolo in (2,3)
     group by substr(a.codice_meccanografico,9,2);
-- **** FINE cursore per PAGAMENTI Stanziamenti UE CAPITALI

begin
delete fin_t_importi_fed_fiscale where anno = p_anno and eu = 'U' and nvl(cofog,'X') = 'S'; -- cancello solo i record relativi al tabulato per Settori
commit;
 for s in siope loop
 num_ord := num_ord + 1;
   for i in 1..35 loop
    colonna(i) := 0;
   end loop;
 k := 0;
 if s.codice_gestionale is not null and nvl(s.visibile,'N') = 'S'
 then
  cod_bil_siope := s.codice_bil1||s.codice_bil2||s.codice_bil3;
  cod_gest_siope := s.codice_gestionale;
-- loop per gli impegni
 for si in settori_imp loop
   k := to_number(si.cod_mecc);
   colonna(k) := nvl(si.tot_impegni,0);
  end loop;
   colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2,COL3
   ,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,s.eu,'I',num_ord,s.codice_bil1,s.codice_bil2,s.codice_bil3,s.descrizione,colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
-- FINE loop per gli impengi

-- loop per i Mandati
  for i in 1..35 loop
  colonna(i) := 0;
  end loop;
   k := 0;
  for sm in settori_mand loop
  k := to_number(sm.cod_mecc);
   colonna(k) := nvl(sm.tot_mandati,0);
  end loop;
   colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
,COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,s.eu,'M',num_ord,s.codice_bil1,s.codice_bil2,s.codice_bil3,s.descrizione,colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
   cod_bil_siope := '';
   cod_gest_siope := '';
  elsif to_number(s.codice_bil2) > 0 and to_number(s.codice_bil3) > 0 and nvl(s.visibile,'N') = 'S'
  then
  cod_bil_siope := s.codice_bil1||s.codice_bil2||s.codice_bil3;
-- loop per gli impegni
  for si1 in settori_imp_1 loop
   k := to_number(si1.cod_mecc);
   colonna(k) := nvl(si1.tot_impegni,0);
  end loop;
   colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2,COL3
   ,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,s.eu,'I',num_ord,s.codice_bil1,s.codice_bil2,s.codice_bil3,s.descrizione,colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
-- FINE loop per gli impengi

-- loop per i Mandati
  for i in 1..34 loop
  colonna(i) := 0;
  end loop;
   k := 0;
  for sm1 in settori_mand_1 loop
  k := to_number(sm1.cod_mecc);
   colonna(k) := nvl(sm1.tot_mandati,0);
  end loop;
  colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2
,COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,s.eu,'M',num_ord,s.codice_bil1,s.codice_bil2,s.codice_bil3,s.descrizione,colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
   cod_bil_siope := '';
  elsif to_number(s.codice_bil2) > 0 and to_number(s.codice_bil3) = 0 and nvl(s.visibile,'N') = 'S'
  then
  cod_bil_siope := s.codice_bil1||s.codice_bil2;
 -- loop per gli impegni
  for si2 in settori_imp_2 loop
   k := to_number(si2.cod_mecc);
   colonna(k) := nvl(si2.tot_impegni,0);
  end loop;
   colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2,COL3
   ,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,s.eu,'I',num_ord,s.codice_bil1,s.codice_bil2,s.codice_bil3,s.descrizione,colonna(1),colonna(2),colonna(3),colonna(4) 
   );
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   commit;
-- FINE loop per gli impengi

-- loop per i Mandati
  for i in 1..35 loop
  colonna(i) := 0;
  end loop;
   k := 0;
  for sm2 in settori_mand_2 loop
  k := to_number(sm2.cod_mecc);
   colonna(k) := nvl(sm2.tot_mandati,0);
  end loop;
  colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2
,COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,s.eu,'M',num_ord,s.codice_bil1,s.codice_bil2,s.codice_bil3,s.descrizione,colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
   cod_bil_siope := '';
 elsif to_number(s.codice_bil2) = 0 and nvl(s.visibile,'N') = 'S'
  then
  cod_bil_siope := s.codice_bil1;
 -- loop per gli impegni
  for si3 in settori_imp_3 loop
   k := to_number(si3.cod_mecc);
   colonna(k) := nvl(si3.tot_impegni,0);
  end loop;
  colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2,COL3
   ,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,s.eu,'I',num_ord,s.codice_bil1,s.codice_bil2,s.codice_bil3,s.descrizione,colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
-- FINE loop per gli impengi

-- loop per i Mandati
  for i in 1..35 loop
  colonna(i) := 0;
  end loop;
   k := 0;
  for sm3 in settori_mand_3 loop
  k := to_number(sm3.cod_mecc);
   colonna(k) := nvl(sm3.tot_mandati,0);
  end loop;
  colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2
,COL3,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,s.eu,'M',num_ord,s.codice_bil1,s.codice_bil2,s.codice_bil3,s.descrizione,colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
   cod_bil_siope := '';
   cod_gest_siope := '';
   end if;
  end loop;
  calcolo_pag_por_residui(p_anno,data_mov);  
  -- ************************************** stanziamenti UE ******************************
  -- ****** IMPEGNI CORR
  
   for i in 1..35 loop
    colonna(i) := 0;
   end loop;
 k := 0;
  end loop;
 for iuc in impegni_ue_corr loop
   k := to_number(iuc.cod_mecc);
   colonna(k) := nvl(iuc.impegni,0);
   colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2,COL3
   ,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,'U','I',901,null,null,null,'Spesa corrente finanziata direttamente dalla UE (escluso cofinanziamento nazionale)',colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
-- FINE impengi CORR
  -- ****** IMPEGNI CAP
  
   for i in 1..35 loop
    colonna(i) := 0;
   end loop;
 k := 0;
 for iuc in impegni_ue_cap loop
   k := to_number(iuc.cod_mecc);
   colonna(k) := nvl(iuc.impegni,0);
  end loop;
   colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
  
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2,COL3
   ,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,'U','I',902,null,null,null,'Spesa c/capitale finanziata direttamente dalla UE (escluso cofinanziamento nazionale)',colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
-- FINE impengi CAP
-- ****** MANDATI CORR
  
   for i in 1..35 loop
    colonna(i) := 0;
   end loop;
 k := 0;
 for iuc in mandati_ue_corr loop
  k := to_number(iuc.cod_mecc);
  if p_anno = 2010 and iuc.cod_mecc = '32' -- modifica LAGALA del 07/04/2011
  then colonna(k) := nvl(iuc.mandati,0) - 500;
  else colonna(k) := nvl(iuc.mandati,0);
  end if;
  end loop;
   colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2,COL3
   ,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,'U','M',901,null,null,null,'Spesa corrente finanziata direttamente dalla UE (escluso cofinanziamento nazionale)',colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
-- FINE impengi CORR
  -- ****** IMPEGNI CAP
  
   for i in 1..35 loop
    colonna(i) := 0;
   end loop;
 k := 0;
 for iuc in mandati_ue_cap loop
   k := to_number(iuc.cod_mecc);
   if p_anno = 2010 and iuc.cod_mecc = '32' -- modifica LAGALA del 07/04/2011
  then colonna(k) := nvl(iuc.mandati,0) - 5000;
  else colonna(k) := nvl(iuc.mandati,0);
  end if;
  end loop;
   colonna(35) := colonna(1)+colonna(2)+colonna(3)+colonna(4) 
  +colonna(5)+colonna(6)+colonna(7)+colonna(8)+colonna(9)+colonna(10)+colonna(11)+colonna(12)+colonna(13)+colonna(14)+colonna(15)
   insert into fin_t_importi_fed_fiscale (ANNO,EU,TIPO_IMPORTI,NUMERO_ORDINE,SIOPE1,SIOPE2,SIOPE3,SIOPE_DESCRIZIONE,COL1,COL2,COL3
  +colonna(16)+colonna(17)+colonna(18)+colonna(19)+colonna(20)+colonna(21)+colonna(22)+colonna(23)+colonna(24)+colonna(25)+colonna(26)
  +colonna(27)+colonna(28)+colonna(29)+colonna(30)+colonna(31)+colonna(32)+colonna(33)+colonna(34);
 
   ,COL4,COL5,COL6,COL7,COL8,COL9,COL10,COL11,COL12,COL13,COL14,COL15,COL16,COL17,COL18,COL19,COL20,COL21,COL22,COL23,COL24,COL25
,COL26,COL27,COL28,COL29,COL30,COL31,COL32,COL33,COL34,COL35,COFOG)
   values (
   p_anno,'U','M',902,null,null,null,'Spesa c/capitale finanziata direttamente dalla UE (escluso cofinanziamento nazionale)',colonna(1),colonna(2),colonna(3),colonna(4) 
  ,colonna(5),colonna(6),colonna(7),colonna(8),colonna(9),colonna(10),colonna(11),colonna(12),colonna(13),colonna(14),colonna(15)
  ,colonna(16),colonna(17),colonna(18),colonna(19),colonna(20),colonna(21),colonna(22),colonna(23),colonna(24),colonna(25),colonna(26)
  ,colonna(27),colonna(28),colonna(29),colonna(30),colonna(31),colonna(32),colonna(33),colonna(34),colonna(35),'S'
   );
   commit;
-- FINE impengi CAP
  
  -- **************************************************************************************
END FED_FISCALE_U_SETTORI;</pre>	</td></tr>
</table></div>