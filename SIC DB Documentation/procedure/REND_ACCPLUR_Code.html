<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="../dbdoc.js" type="text/javascript"></script>
<link href="../dbdoc.css" type="text/css" rel="stylesheet">
</head>
<body class="object">
<div id="header"><h2>REND_ACCPLUR</h2>
<div class="tabs clearfix">

<div class="tab"><div><a href="REND_ACCPLUR.html">Details</a></div></div>
<div class="tab"><div><a href="REND_ACCPLUR_Grants.html">Grants</a></div></div>
<div class="tab"><div><a href="REND_ACCPLUR_References.html">References</a></div></div>
<div class="tab"><div><a href="REND_ACCPLUR_Dependencies.html">Dependencies</a></div></div>
<div class="tab" id="current"><div><a href="REND_ACCPLUR_Code.html">Code</a></div></div>
</div></div><br/>
<div class="tab-panes">
<div id="Code"> <table cellpadding="0" cellspacing="0" cellspacing="0" summary=""><tr>
	<th>TEXT</th>
</tr>
	<tr><td><pre>
procedure rend_accplur (p_anno number,p_utente varchar2) is

p_titolo varchar2(50);
p_tipologia varchar2(50);

acc1 number(15,2) := 0;
acc2 number(15,2) := 0;
acc3 number(15,2) := 0;



appoggio number(15,2) := 0;
c_riga number := 1;

CP_imp1annodopo number(15,2) := 0;
CP_imp2annidopo number(15,2) := 0;
CP_impannisucc number(15,2) := 0;
CP_prcomp1annodopo number(15,2) := 0;
CP_prcomp2annidopo number(15,2) := 0;
CP_prcompannisucc number(15,2) := 0;

TOT_imp1annodopo number(15,2) := 0;
TOT_imp2annidopo number(15,2) := 0;
TOT_impannisucc number(15,2) := 0;
TOT_prcomp1annodopo number(15,2) := 0;
TOT_prcomp2annidopo number(15,2) := 0;
TOT_prcompannisucc number(15,2) := 0;

acc1_c number(15,2) := 0; --per i dati del consiglio in caso di Consolidato
acc2_c number(15,2) := 0; --per i dati del consiglio in caso di Consolidato
acc3_c number(15,2) := 0; --per i dati del consiglio in caso di Consolidato

plur1_c number(15,2) := 0; --per i dati del consiglio in caso di Consolidato
plur2_c number(15,2) := 0; --per i dati del consiglio in caso di Consolidato
plur3_c number(15,2) := 0; --per i dati del consiglio in caso di Consolidato



cursor titoli is
select distinct liv1,desc_liv1 descrizione
from vw_nb_articoli
where anno = p_anno
and eu = 'E'
and nvl(abilitato,'N') = 'S'
and substr(liv1,1,1) &lt;> '7'
order by to_number(liv1);

cursor tipologia is
select distinct liv2,desc_liv2 descrizione
from vw_nb_articoli
where anno = p_anno
and eu = 'E'
and nvl(abilitato,'N') = 'S'
and liv1 = p_titolo
order by to_number(liv2);

cursor cap1 is
select a.eu||a.codice capitolo
from fin_t_articoli a,
vw_nb_articoli b
where a.anno = p_anno + 1 AND
a.eu = 'E' AND
b.anno = p_anno AND
b.eu||b.codice = a.codice_precedente AND
nvl(b.abilitato,'N') = 'S' AND
b.liv2  = p_tipologia;


cursor cap2 is
select a.eu||a.codice capitolo
from fin_t_articoli a,
fin_t_articoli b,
vw_nb_articoli c
where a.anno = p_anno + 2 AND
a.eu = 'E' AND
b.anno = p_anno + 1 AND
b.eu||b.codice = a.codice_precedente and
c.anno = p_anno AND
c.eu||c.codice = b.codice_precedente AND
nvl(c.abilitato,'N') = 'S' AND
c.liv2 = p_tipologia;

cursor cap3 is
select a.eu||a.codice capitolo
from fin_t_articoli a,
fin_t_articoli b,
fin_t_articoli c,
vw_nb_articoli d
where a.anno = p_anno + 3 AND
a.eu = 'E' AND
b.anno = p_anno + 2 AND
b.eu||b.codice = a.codice_precedente and
c.anno = p_anno + 1 AND
c.eu||c.codice = b.codice_precedente AND
d.anno = p_anno AND
d.eu||d.codice = c.codice_precedente AND
nvl(d.abilitato,'N') = 'S' AND
d.liv2 = p_tipologia;

begin


delete FIN_T_RENDICONTO_ACCPLUR where anno = p_anno and utente = p_utente;
commit;
 -- accertamenti

 for tit in titoli loop
 p_titolo := tit.liv1;

     for t in tipologia loop
    
     p_tipologia := t.liv2;
    
     for c in cap1 loop
     SELECT NVL(SUM(impegni),0) impegni
     INTO acc1
     FROM (SELECT NVL(SUM(NVL(d.document_amount,0)),0) impegni
           FROM fin_t_documenti d
           WHERE d.doc_type = 'ACC' AND
                 NVL(d.deletion_status_flag,'N') = 'N' AND
                 d.date_created = TO_DATE('0101'||(p_anno + 1),'ddmmyyyy') AND
                 d.attribute21 is null AND
                 substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno AND -- substr(nvl(d.attribute38,'9999'),1,4) = p_anno AND
                 d.segment8 = p_anno + 1 AND
                 d.segment2 = c.capitolo 
                 UNION ALL
                 select nvl(sum(nvl(f.importo_variazione,0)),0) impegni
                          from FIN_T_VARIAZIONI_FPV f
                          where to_char(f.data_variazione,'yyyy') > p_anno
                          --and f.importo_originario = f.importo_variazione
                          and f.doc_id in (select d.doc_id 
                          from fin_t_documenti d
                          where d.doc_type = 'ACC'
                          and d.segment8 = p_anno+1
                          and d.attribute21 is null
                          and d.date_created = to_date('0101'||(p_anno+1),'ddmmyyyy')
                          and substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno -- and substr(nvl(d.attribute38,'9999'),1,4) = p_anno
                          and d.segment2 = c.capitolo));
    
       CP_imp1annodopo := nvl(CP_imp1annodopo,0) + acc1;
       TOT_imp1annodopo := nvl(TOT_imp1annodopo,0) + acc1;
                  
       CP_prcomp1annodopo := CP_prcomp1annodopo + pluriennale1_definitivo(p_anno+1,c.capitolo);
       TOT_prcomp1annodopo := TOT_prcomp1annodopo + pluriennale1_definitivo(p_anno+1,c.capitolo);
       end loop;
    
    
     -- accertamenti
    
     for c in cap2 loop
     SELECT NVL(SUM(impegni),0) impegni
     INTO acc2
     FROM (SELECT NVL(SUM(NVL(d.document_amount,0)),0) impegni
           FROM fin_t_documenti d
           WHERE d.doc_type = 'ACC' AND
                 NVL(d.deletion_status_flag,'N') = 'N' AND
                 d.date_created = TO_DATE('0101'||(p_anno + 2),'ddmmyyyy') AND
                 d.attribute21 is null AND
                 substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno AND -- substr(nvl(d.attribute38,'9999'),1,4) = p_anno AND
                 d.segment8 = p_anno + 2 AND
                 d.segment2 = c.capitolo 
                 UNION ALL
                 select nvl(sum(nvl(f.importo_variazione,0)),0) impegni
                          from FIN_T_VARIAZIONI_FPV f
                          where to_char(f.data_variazione,'yyyy') > p_anno
                          --and f.importo_originario = f.importo_variazione
                          and f.doc_id in (select d.doc_id 
                          from fin_t_documenti d
                          where d.doc_type = 'ACC'
                          --and nvl(d.deletion_status_flag,'N') = 'Y'
                          and d.segment8 = p_anno + 2
                          and d.attribute21 is null
                          and d.date_created = to_date('0101'||(p_anno + 2),'ddmmyyyy')
                          and substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno -- and substr(nvl(d.attribute38,'9999'),1,4) = p_anno
                          and d.segment2 = c.capitolo));
    
      CP_imp2annidopo := nvl(CP_imp2annidopo,0) + acc2;
      TOT_imp2annidopo := nvl(TOT_imp2annidopo,0) + acc2;
    
      CP_prcomp2annidopo := CP_prcomp2annidopo + pluriennale2_definitivo(p_anno+2,c.capitolo);
      TOT_prcomp2annidopo := TOT_prcomp2annidopo + pluriennale2_definitivo(p_anno+2,c.capitolo);
      end loop;
    
    
    for c in cap3 loop
              SELECT NVL(SUM(impegni),0) impegni
     INTO acc3
     FROM (SELECT NVL(SUM(NVL(d.document_amount,0)),0) impegni
           FROM fin_t_documenti d
           WHERE d.doc_type = 'ACC' AND
                 NVL(d.deletion_status_flag,'N') = 'N' AND
                 d.date_created = TO_DATE('0101'||(p_anno + 3),'ddmmyyyy') AND
                 d.attribute21 is null AND
                 substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno AND -- substr(nvl(d.attribute38,'9999'),1,4) = p_anno AND
                 d.segment8 = p_anno + 3 AND
                 d.segment2  = c.capitolo 
                 UNION ALL
                 select nvl(sum(nvl(f.importo_variazione,0)),0) impegni
                  from FIN_T_VARIAZIONI_FPV f
                  where f.anno > p_anno
                  --and f.importo_originario = f.importo_variazione
                  and f.doc_id in (select d.doc_id 
                  from fin_t_documenti d
                  where d.doc_type = 'ACC'
                  --and nvl(d.deletion_status_flag,'N') = 'Y'
                  and d.segment8 = p_anno + 3
                  and d.attribute21 is null
                  and d.date_created = to_date('0101'||(p_anno + 3),'ddmmyyyy')
                  and substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno -- and substr(nvl(d.attribute38,'9999'),1,4) = p_anno
                  and d.segment2 = c.capitolo));
    
      CP_impannisucc := nvl(CP_impannisucc,0) + acc3;
      TOT_impannisucc := nvl(TOT_impannisucc,0) + acc3;
    
      CP_prcompannisucc  := CP_prcompannisucc  + previsione_definitiva(p_anno+3,c.capitolo);
      TOT_prcompannisucc  := TOT_prcompannisucc  + previsione_definitiva(p_anno+3,c.capitolo);
      
      if p_utente = 'CONSOLIDATO'
      then
      -- anno 1 dati consiglio
      SELECT NVL(SUM(impegni),0) impegni
      INTO acc1_c
      FROM (SELECT NVL(SUM(NVL(d.document_amount,0)),0) impegni
           FROM sic_consiglio.fin_t_documenti d
           WHERE d.doc_type = 'ACC' AND
                 NVL(d.deletion_status_flag,'N') = 'N' AND
                 d.date_created = TO_DATE('0101'||(p_anno + 1),'ddmmyyyy') AND
                 d.attribute21 is null AND
                 substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno AND -- substr(nvl(d.attribute38,'9999'),1,4) = p_anno AND
                 d.segment8 = p_anno + 1 AND
                 d.segment2 in     (select a.eu||a.codice capitolo
                                    from sic_consiglio.fin_t_articoli a,
                                    sic_consiglio.vw_nb_articoli b
                                    where a.anno = p_anno + 1 AND
                                    a.eu = 'E' AND
                                    b.anno = p_anno AND
                                    b.eu||b.codice = a.codice_precedente AND
                                    nvl(b.abilitato,'N') = 'S' AND
                                    b.liv2  = p_tipologia)
                 UNION ALL
                 select nvl(sum(nvl(f.importo_variazione,0)),0) impegni
                          from sic_consiglio.FIN_T_VARIAZIONI_FPV f
                          where to_char(f.data_variazione,'yyyy') > p_anno
                          --and f.importo_originario = f.importo_variazione
                          and f.doc_id in (select d.doc_id 
                          from fin_t_documenti d
                          where d.doc_type = 'ACC'
                          and d.segment8 = p_anno+1
                          and d.attribute21 is null
                          and d.date_created = to_date('0101'||(p_anno+1),'ddmmyyyy')
                          and substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno -- and substr(nvl(d.attribute38,'9999'),1,4) = p_anno
                          and d.segment2 in     (select a.eu||a.codice capitolo
                                    from sic_consiglio.fin_t_articoli a,
                                    sic_consiglio.vw_nb_articoli b
                                    where a.anno = p_anno + 1 AND
                                    a.eu = 'E' AND
                                    b.anno = p_anno AND
                                    b.eu||b.codice = a.codice_precedente AND
                                    nvl(b.abilitato,'N') = 'S' AND
                                    b.liv2  = p_tipologia)));
                                    
        select nvl(sum(sic_consiglio.pluriennale1_definitivo(p_anno+1,a.eu||a.codice)),0)
        into plur1_c
        from sic_consiglio.fin_t_articoli a,
        sic_consiglio.vw_nb_articoli b
        where a.anno = p_anno + 1 AND
        a.eu = 'E' AND
        b.anno = p_anno AND
        b.eu||b.codice = a.codice_precedente AND
        nvl(b.abilitato,'N') = 'S' AND
        b.liv2  = p_tipologia;
        

        -- anno 2 dati consiglio
        
         SELECT NVL(SUM(impegni),0) impegni
      INTO acc2_c
      FROM (SELECT NVL(SUM(NVL(d.document_amount,0)),0) impegni
           FROM sic_consiglio.fin_t_documenti d
           WHERE d.doc_type = 'ACC' AND
                 NVL(d.deletion_status_flag,'N') = 'N' AND
                 d.date_created = TO_DATE('0101'||(p_anno + 2),'ddmmyyyy') AND
                 d.attribute21 is null AND
                 substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno AND -- substr(nvl(d.attribute38,'9999'),1,4) = p_anno AND
                 d.segment8 = p_anno + 2 AND
                 d.segment2 in     (select a.eu||a.codice capitolo
                                    from sic_consiglio.fin_t_articoli a,
                                    a.eu = 'E' AND
                                    sic_consiglio.fin_t_articoli b,
                                    sic_consiglio.vw_nb_articoli c
                                    where a.anno = p_anno + 2 AND
                                    b.anno = p_anno + 1 AND
                                    b.eu||b.codice = a.codice_precedente and
                                    c.anno = p_anno AND
                                    c.eu||c.codice = b.codice_precedente AND
                                    nvl(c.abilitato,'N') = 'S' AND
                                    c.liv2 = p_tipologia)
                 UNION ALL
                 select nvl(sum(nvl(f.importo_variazione,0)),0) impegni
                          from sic_consiglio.FIN_T_VARIAZIONI_FPV f
                          where to_char(f.data_variazione,'yyyy') > p_anno
                          --and f.importo_originario = f.importo_variazione
                          and f.doc_id in (select d.doc_id 
                          from fin_t_documenti d
                          where d.doc_type = 'ACC'
                          and d.segment8 = p_anno+2
                          and d.attribute21 is null
                          and d.date_created = to_date('0101'||(p_anno+1),'ddmmyyyy')
                          and substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno -- and substr(nvl(d.attribute38,'9999'),1,4) = p_anno
                          and d.segment2 in     (select a.eu||a.codice capitolo
                                                from sic_consiglio.fin_t_articoli a,
                                                sic_consiglio.fin_t_articoli b,
                                                sic_consiglio.vw_nb_articoli c
                                                where a.anno = p_anno + 2 AND
                                                a.eu = 'E' AND
                                                b.anno = p_anno + 1 AND
                                                b.eu||b.codice = a.codice_precedente and
                                                c.anno = p_anno AND
                                                c.eu||c.codice = b.codice_precedente AND
                                                nvl(c.abilitato,'N') = 'S' AND
                                                c.liv2 = p_tipologia)));
                                    
        select nvl(sum(sic_consiglio.pluriennale2_definitivo(p_anno+2,a.eu||a.codice)),0)
        into plur2_c
       from sic_consiglio.fin_t_articoli a,
                                                sic_consiglio.fin_t_articoli b,
                                                sic_consiglio.vw_nb_articoli c
                                                where a.anno = p_anno + 2 AND
                                                a.eu = 'E' AND
                                                b.anno = p_anno + 1 AND
                                                b.eu||b.codice = a.codice_precedente and
                                                c.anno = p_anno AND
                                                c.eu||c.codice = b.codice_precedente AND
                                                nvl(c.abilitato,'N') = 'S' AND
                                                c.liv2 = p_tipologia;
         -- anno 3 dati consiglio
        
         SELECT NVL(SUM(impegni),0) impegni
      INTO acc3_c
      FROM (SELECT NVL(SUM(NVL(d.document_amount,0)),0) impegni
           FROM sic_consiglio.fin_t_documenti d
           WHERE d.doc_type = 'ACC' AND
                 NVL(d.deletion_status_flag,'N') = 'N' AND
                 d.date_created = TO_DATE('0101'||(p_anno + 3),'ddmmyyyy') AND
                 d.attribute21 is null AND
                 substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno AND -- substr(nvl(d.attribute38,'9999'),1,4) = p_anno AND
                 d.segment8 = p_anno + 3 AND
                 d.segment2 in     (select a.eu||a.codice capitolo
                                    from sic_consiglio.fin_t_articoli a,
                                    sic_consiglio.fin_t_articoli b,
                                    sic_consiglio.fin_t_articoli c,
                                    sic_consiglio.vw_nb_articoli d
                                    where a.anno = p_anno + 3 AND
                                    a.eu = 'E' AND
                                    b.anno = p_anno + 2 AND
                                    b.eu||b.codice = a.codice_precedente and
                                    c.anno = p_anno + 1 AND
                                    c.eu||c.codice = b.codice_precedente AND
                                    d.anno = p_anno AND
                 UNION ALL
                                    d.eu||d.codice = c.codice_precedente AND
                                    nvl(d.abilitato,'N') = 'S' AND
                                    d.liv2 = p_tipologia)
                 select nvl(sum(nvl(f.importo_variazione,0)),0) impegni
                          from sic_consiglio.FIN_T_VARIAZIONI_FPV f
                          where to_char(f.data_variazione,'yyyy') > p_anno
                          --and f.importo_originario = f.importo_variazione
                          and f.doc_id in (select d.doc_id 
                          from fin_t_documenti d
                          where d.doc_type = 'ACC'
                          and d.segment8 = p_anno+2
                          and d.attribute21 is null
                          and d.date_created = to_date('0101'||(p_anno+1),'ddmmyyyy')
                          and substr(nvl(d.attribute38,'9999'),1,4) &lt;= p_anno -- and substr(nvl(d.attribute38,'9999'),1,4) = p_anno
                          and d.segment2 in     (select a.eu||a.codice capitolo
                                                from sic_consiglio.fin_t_articoli a,
                                                sic_consiglio.fin_t_articoli b,
                                                sic_consiglio.fin_t_articoli c,
                                                sic_consiglio.vw_nb_articoli d
                                                where a.anno = p_anno + 3 AND
                                                a.eu = 'E' AND
                                                b.anno = p_anno + 2 AND
                                                b.eu||b.codice = a.codice_precedente and
                                                c.anno = p_anno + 1 AND
                                                c.eu||c.codice = b.codice_precedente AND
                                                d.anno = p_anno AND
                                                d.eu||d.codice = c.codice_precedente AND
                                                nvl(d.abilitato,'N') = 'S' AND
                                                d.liv2 = p_tipologia)));
                                    
        select nvl(sum(sic_consiglio.previsione_definitiva(p_anno+3,a.eu||a.codice)),0)
        into plur3_c
       from sic_consiglio.fin_t_articoli a,
                                                sic_consiglio.fin_t_articoli b,
                                                sic_consiglio.fin_t_articoli c,
                                                sic_consiglio.vw_nb_articoli d
                                                where a.anno = p_anno + 3 AND
                                                a.eu = 'E' AND
                                                b.anno = p_anno + 2 AND
                                                b.eu||b.codice = a.codice_precedente and
                                                c.anno = p_anno + 1 AND
                                                c.eu||c.codice = b.codice_precedente AND
                                                d.anno = p_anno AND
                                                d.eu||d.codice = c.codice_precedente AND
      
                                                nvl(d.abilitato,'N') = 'S' AND
                                                d.liv2 = p_tipologia;
      end if;
       CP_imp1annodopo := nvl(CP_imp1annodopo,0) + acc1_c;
       TOT_imp1annodopo := nvl(TOT_imp1annodopo,0) + acc1_c;
                  
       CP_prcomp1annodopo := CP_prcomp1annodopo + plur1_c;
       TOT_prcomp1annodopo := TOT_prcomp1annodopo + plur1_c;
    
    
      CP_imp2annidopo := nvl(CP_imp2annidopo,0) + acc2_c;
      TOT_imp2annidopo := nvl(TOT_imp2annidopo,0) + acc2_c;
    
      CP_prcomp2annidopo := CP_prcomp2annidopo + plur2_c;
      TOT_prcomp2annidopo := TOT_prcomp2annidopo + plur2_c;
      
      CP_impannisucc := nvl(CP_impannisucc,0) + acc3_c;
      TOT_impannisucc := nvl(TOT_impannisucc,0) + acc3_c;
    
      CP_prcompannisucc  := CP_prcompannisucc  + plur3_c;
      TOT_prcompannisucc  := TOT_prcompannisucc  + plur3_c;
      
      
     end loop;
     --
    
          insert into fin_t_rendiconto_accplur (
          DATA_GENERAZIONE
          ,UTENTE
          ,RIGA
          ,ANNO
          ,CODICE
          ,DESCRIZIONE
          ,PREVCOMPE1
          ,ACC1
          ,PREVCOMPE2
          ,ACC2
          ,ACCN
          ,TAG_BDAP_PREVCOMPE1
          ,TAG_BDAP_ACC1
          ,TAG_BDAP_PREVCOMPE2
          ,TAG_BDAP_ACC2
          ,TAG_BDAP_ACCN)     
          values
          (sysdate
          ,p_utente
          ,c_riga
          ,p_anno
          ,t.liv2
          ,t.descrizione
          ,CP_prcomp1annodopo
          ,CP_imp1annodopo
          ,CP_prcomp2annidopo
          ,CP_imp2annidopo
          ,CP_impannisucc
          ,'ENT-ACCPLU_E.'||substr(t.liv2,1,1)||'.'||substr(t.liv2,2,2)||'.'||substr(t.liv2,4,2)||'.00.000_Anno1CP'
          ,'ENT-ACCPLU_E.'||substr(t.liv2,1,1)||'.'||substr(t.liv2,2,2)||'.'||substr(t.liv2,4,2)||'.00.000_Anno1A'
          ,'ENT-ACCPLU_E.'||substr(t.liv2,1,1)||'.'||substr(t.liv2,2,2)||'.'||substr(t.liv2,4,2)||'.00.000_Anno2CP'
          ,'ENT-ACCPLU_E.'||substr(t.liv2,1,1)||'.'||substr(t.liv2,2,2)||'.'||substr(t.liv2,4,2)||'.00.000_Anno2A'
          ,'ENT-ACCPLU_E.'||substr(t.liv2,1,1)||'.'||substr(t.liv2,2,2)||'.'||substr(t.liv2,4,2)||'.00.000_AnnoNA'
          );
    
          c_riga := c_riga + 1;
          CP_imp1annodopo := 0;
          CP_imp2annidopo := 0;
          CP_impannisucc := 0;
          CP_prcomp1annodopo := 0;
          CP_prcomp2annidopo := 0;
          CP_prcompannisucc := 0;
    
    
     end loop;
     commit;
    
         insert into fin_t_rendiconto_accplur (
         DATA_GENERAZIONE
         ,UTENTE
         ,RIGA
         ,ANNO
         ,CODICE
         ,DESCRIZIONE
         ,ACC2
         ,PREVCOMPE1
         ,ACC1
         ,PREVCOMPE2
         ,ACCN
         ,TAG_BDAP_PREVCOMPE1
         ,TAG_BDAP_ACC1
         ,TAG_BDAP_PREVCOMPE2
         ,TAG_BDAP_ACC2
         ,TAG_BDAP_ACCN)     
         values
         (sysdate
         ,p_utente
         ,c_riga
         ,p_anno
         ,tit.liv1
         ,'Totale TITOLO '||substr(tit.liv1,1,1)
         ,TOT_prcomp1annodopo
         ,TOT_imp1annodopo
         ,TOT_prcomp2annidopo
         ,TOT_imp2annidopo
         ,TOT_impannisucc
         ,'ENT-ACCPLU_E.'||substr(tit.liv1,1,1)||'.00.00.00.000_Anno1CP'
         ,'ENT-ACCPLU_E.'||substr(tit.liv1,1,1)||'.00.00.00.000_Anno1A'
         ,'ENT-ACCPLU_E.'||substr(tit.liv1,1,1)||'.00.00.00.000_Anno2CP'
         ,'ENT-ACCPLU_E.'||substr(tit.liv1,1,1)||'.00.00.00.000_Anno2A'
         ,'ENT-ACCPLU_E.'||substr(tit.liv1,1,1)||'.00.00.00.000_AnnoNA'
         );
    
    
        c_riga := c_riga + 1;
        TOT_imp1annodopo := 0;
        TOT_imp2annidopo := 0;
        TOT_impannisucc := 0;
        TOT_prcomp1annodopo := 0;
        TOT_prcomp2annidopo := 0;
        TOT_prcompannisucc := 0;
    
    
    end loop;
  commit;

insert into fin_t_rendiconto_accplur (
 DATA_GENERAZIONE
 ,UTENTE
 ,RIGA
 ,ANNO
 ,DESCRIZIONE
 ,PREVCOMPE1
 ,ACC1
 ,PREVCOMPE2
 ,ACC2
 ,ACCN
 ,TAG_BDAP_PREVCOMPE1
 ,TAG_BDAP_ACC1
 ,TAG_BDAP_PREVCOMPE2
 ,TAG_BDAP_ACC2
 ,TAG_BDAP_ACCN)     
 (select sysdate
 ,p_utente
 ,c_riga
 ,p_anno
 ,'TOTALE ACCERTAMENTI'
 ,nvl(sum(prevcompe1),0)
 ,nvl(sum(acc1),0)
 ,nvl(sum(prevcompe2),0)
 ,nvl(sum(acc2),0)
 ,nvl(sum(accn),0)
 ,'ENT-ACCPLU_TotaleAccertamenti_Anno1CP'
 ,'ENT-ACCPLU_TotaleAccertamenti_Anno1A'
 ,'ENT-ACCPLU_TotaleAccertamenti_Anno2CP'
 ,'ENT-ACCPLU_TotaleAccertamenti_Anno2A'
 ,'ENT-ACCPLU_TotaleAccertamenti_AnnoNA'
 from fin_t_rendiconto_accplur
 where anno = p_anno
 and utente = p_utente
 and substr(codice,2) = '000000'
 );
commit;

end;</pre>	</td></tr>
</table></div>