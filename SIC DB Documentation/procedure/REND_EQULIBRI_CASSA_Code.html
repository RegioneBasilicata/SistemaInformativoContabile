<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="../dbdoc.js" type="text/javascript"></script>
<link href="../dbdoc.css" type="text/css" rel="stylesheet">
</head>
<body class="object">
<div id="header"><h2>REND_EQULIBRI_CASSA</h2>
<div class="tabs clearfix">

<div class="tab"><div><a href="REND_EQULIBRI_CASSA.html">Details</a></div></div>
<div class="tab"><div><a href="REND_EQULIBRI_CASSA_Grants.html">Grants</a></div></div>
<div class="tab"><div><a href="REND_EQULIBRI_CASSA_References.html">References</a></div></div>
<div class="tab"><div><a href="REND_EQULIBRI_CASSA_Dependencies.html">Dependencies</a></div></div>
<div class="tab" id="current"><div><a href="REND_EQULIBRI_CASSA_Code.html">Code</a></div></div>
</div></div><br/>
<div class="tab-panes">
<div id="Code"> <table cellpadding="0" cellspacing="0" cellspacing="0" summary=""><tr>
	<th>TEXT</th>
</tr>
	<tr><td><pre>
procedure  REND_EQULIBRI_CASSA(p_anno in number,p_utente in varchar2,p_id_report in number) as
 
 riga number :=0;
 c1 VARCHAR2(1000); --descrizione voce
 c2 VARCHAR2(100); -- segno (+)/(-)
 c3 VARCHAR2(100); -- desc colonna importi
 c4 VARCHAR2(1); -- per Evidenziare la riga corrispondente nel report
 c5 VARCHAR2(1000); --TAG BDAP

 n1 NUMBER := 0; -- per colonna "Accertamenti/Impegni"
 nx number := 0; -- per valori di appoggio

 A_eq number := 0; -- A) Equilibrio di parte corrente
 B_eq number := 0; -- B) Equilibrio di parte capitale
 C_eq number := 0; -- C) Variazioni attività finanziaria
 D_eq number := 0; -- D) Saldo Anticipazioni/Rimborsi sanità dell'anno
 E_eq number := 0; -- E) Saldo conto terzi e partite di giro
 F_eq number := 0; -- F) Saldo antcipazioni/rimborsi tesoriere


 D1_eq number := 0; -- Equilibrio di parte corrente ai fini della copertura degli investimenti plurien.
 D2_eq number := 0; -- Equilibrio di parte corrente ai fini della copertura degli investimenti plurien.

 v1 NUMBER := 0; -- utilizzato come appoggio
 v2 NUMBER := 0; -- utilizzato come appoggio
 v3 NUMBER := 0; -- utilizzato come appoggio
 v4 NUMBER := 0; -- utilizzato come appoggio
 v5 NUMBER := 0; -- utilizzato come appoggio
 v6 NUMBER := 0; -- utilizzato come appoggio

 i number := 0; --contatore generico
 imp_man number := 0; --utilizzato per la quota da inserire extracontabilmente 
 utilizzo_av_corr number := 0; ----utilizzato per inserire la quota di Utilizzo risultato di amministrazione destinato al finanziamento delle spese correnti e al rimborso di prestiti
 fpv_e_corrente number := 0; --utilizzato per inserire la quota di FPV entrate di parte corrente
 fpv_e_capitale number := 0; --utilizzato per inserire la quota di FPV entrate di parte capitale
 fpv_u_corrente number := 0; --utilizzato per inserire la quota di FPV uscite di parte corrente
 fpv_u_capitale number := 0; --utilizzato per inserire la quota di FPV uscite di parte capitale

 fpv_e_corr_libero number := 0; --utilizzato per inserire la quota di FPV entrate di parte corrente NON VINCOLATA
 fpv_u_corr_libero number := 0; --utilizzato per inserire la quota di FPV uscite di parte corrente NON VINCOLATA

 vdata_elaborazione date;
 p_anno1 number(4);
 p_anno2 number(4);

 capitolo_entrata varchar2(6);
 impegnato_vinc number := 0;
 impegnato_vinc_ver number := 0;
 impegnato_mutui number := 0;
 impegnato_vinc1 number := 0;
 impegnato_vinc2 number := 0;
 impegnato_fpv number := 0;


 capitolo_uscita varchar2(6);

 cursor e_vinc is
 select TIPO_CAPITOLO||capitolo capitolo
 ,nvl(ACCERTAMENTI_IMPEGNI_COMPE,0) ACCERTATO
 ,note_sanita
 from fin_t_consuntivo_excel
 where ANNO_CONSUNTIVO = p_anno
 and UTENTE = p_utente
 and TIPO_CAPITOLO = 'E'
 and nvl(nb_entrata_ricorrente,'N') = 'N'
 and note_sanita is not null;

 cursor u_vinc is
 select tipo_capitolo||capitolo capitolo
 ,nvl(avanzo_vincolato,0) avanzo_vincolato,nvl(mutui,0) mutui
   from fin_t_consuntivo_excel u
   where u.ANNO_CONSUNTIVO = p_anno
   and u.UTENTE = p_utente
   and u.TIPO_CAPITOLO = 'U'
   and instr(u.note_sanita,capitolo_entrata) > 0;


-- Vale a partire dal rendiconto 2016.

BEGIN

 DELETE fin_t_rendiconto_equilibri 
 WHERE utente = p_utente AND anno = p_anno and nvl(cassa,'N') = 'S';--inserimento colonna Anno 30-09-2019 Gerry
 COMMIT;



-- *** li commento perchè tanto prima di lanciare gli allegati va lanciato il consuntivo *******
-- consuntivo_entrate(p_anno,null,to_date('3112'||p_anno,'ddmmyyyy'),p_utente);
-- consuntivo_uscite(p_anno,null,to_date('3112'||p_anno,'ddmmyyyy'),p_utente);

 select nvl(sum(nvl(fpv,0)),0) into fpv_u_corrente
 from fin_t_consuntivo_excel
 where ANNO_CONSUNTIVO = p_anno
 and UTENTE = p_utente
 and TIPO_CAPITOLO = 'U'
 and NB_TITOLO = '1';

 select nvl(sum(nvl(fpv,0)),0) into fpv_u_capitale
 from fin_t_consuntivo_excel
 where ANNO_CONSUNTIVO = p_anno
 and UTENTE = p_utente
 and TIPO_CAPITOLO = 'U'
 and NB_TITOLO = '2';


 -- riga 1 intestazione principale 

 riga := 1;
 c1 := 'EQUILIBRI DI CASSA';
 c2 := '';
 c3 := 'RENDICONTO '||p_anno;


  INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car03,utente,num_ord_riga,anno,cassa) 
  VALUES (c1,c2,c3,p_utente,riga,p_anno,'S');  
  commit;

/*
-- riga 2 Utilizzo risultato di amministrazione
 riga := 2;
 c1 := 'Utilizzo risultato di amministrazione destinato al finanziamento delle spese correnti e al rimborso di prestiti';
 c2 := '(+)';
 c5 := 'EQREG-COR_UtilizzoRisultatoAmmFinanzSpeseCorrenti';-- riga TAG BDAP
 n1 := 0; -- importo manuale??

      select nvl(sum(avanzo_vincolato),0) into n1
      from fin_t_consuntivo_excel
      where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = 1
      and nvl(AVANZO_VINCOLATO,0) > 0;

 utilizzo_av_corr := n1;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');   
 commit;

 A_eq := A_eq + n1;

-- riga 3 Ripiano disavanzo di amministrazione
 riga := 3;
 c1 := 'Ripiano disavanzo  di amministrazione esercizio precedente';
 c2 := '(-)';
 c5 := 'EQREG-COR_RipianoDisavanzoAmmEsercizioPrecedente';-- riga TAG BDAP
 n1 := 0;

      select nvl(disavanzo_amministrazione,0)
      into n1
      from fin_t_dati_generali
      where anno_finanziario = p_anno;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');   
 commit;

 A_eq := A_eq - n1;

-- riga 4 FPV corrente Entrata
 riga := 4;
 c1 := 'Fondo pluriennale vincolato per spese correnti iscritto in entrata ';
 c2 := '(+)';
 c5 := 'EQREG-COR_FPVSpeseCorrentiIscrittoEntrata';-- riga TAG BDAP
 n1 := 0;


    select 
    NVL(SUM(nvl(FPV_FONTE,0)),0)
    into fpv_e_corrente
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '1';

      n1 := fpv_e_corrente;

  INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
 commit;

 A_eq := A_eq + n1;
*/
-- riga 5 Entrate 1,2,3
 riga := 5;
 c1 := 'Entrate titoli 1-2-3';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateTitoli1-2-3';-- riga TAG BDAP
 n1 := 0;

    select 
    NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO1,1,1) in ('1','2','3');

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq + n1;

-- riga 6 Entrate in conto capitale per contributi agli investimenti
 riga := 6;
 c1 := 'Entrate in conto capitale per Contributi agli investimenti direttamente destinati al rimborso dei prestiti da amministrazioni pubbliche';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateCCapitaleContribInvestRimborsoPrestitiPA';-- riga TAG BDAP
 n1 := 0;

    select 
     NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and NB_LIVELLO3 = '4020600';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq + n1;

-- riga 7 Entrate Titolo  4.03   - Altri trasferimenti in conto capitale
 riga := 7;
 c1 := 'Entrate Titolo  4.03   - Altri trasferimenti in conto capitale';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateTitolo4.03';-- riga TAG BDAP
 n1 := 0;

 select 
    NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO2,1,3) = '403';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq + n1;

-- riga 8 Entrate in c/capitale destinate all'estinzione anticipata di prestiti
 riga := 8;
 c1 := 'Entrate in c/capitale destinate all''estinzione anticipata di prestiti';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateCCapitaleEAP';-- riga TAG BDAP
 n1 := 0;


  select 
    NVL(SUM(nvl(document_amount,0)),0)
    into n1
    from fin_t_documenti
    where segment8 = p_anno
      and doc_type = 'REV'
      and nvl(open_balance_proposed,0) > 0
      and substr(attribute16,1,9) = 'E.4.02.06';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq + n1;

-- riga 9 Entrate per accensioni di prestiti destinate all'estinzione anticipata di prestiti
 riga := 9;
 c1 := 'Entrate per accensioni di prestiti destinate all''estinzione anticipata di prestiti';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateAccensPrestitiEAP';-- riga TAG BDAP
 n1 := 0;


 -- ricavo n1 da fnd_reports_importi_man
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_9'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq + n1;

-- riga 10 Entrate di parte capitale destinate a spese correnti in base a specifiche disposizioni di legge o  dei principi contabili
 riga := 10;
 c1 := 'Entrate di parte capitale destinate a spese correnti in base a specifiche disposizioni di legge o  dei principi contabili';
 c2 := '(+)';
 c5 := 'EQREG-COR_EntrateParteCapitaleDestinateSpeseCorrenti';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_10'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq + n1;

-- riga 11 Spese Correnti
 riga := 11;
 c1 := 'Spese correnti';
 c2 := '(-)';
 c5 := 'EQREG-COR_SpeseCorrenti';-- riga TAG BDAP
 n1 := 0;


  select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '1';

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq - n1;
/*
-- riga 12 Fondo pluriennale vincolato di parte corrente (di spesa)
 riga := 12;
 c1 := 'Fondo pluriennale vincolato di parte corrente (di spesa)';
 c2 := '(-)';
 c5 := 'EQREG-COR_SpeseCorrentiFPV';-- riga TAG BDAP
 n1 := fpv_u_corrente;


 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq - n1;
*/
-- riga 13 Spese Titolo 2.04 -  Altri trasferimenti in conto capitale
 riga := 13;
 c1 := 'Spese Titolo 2.04 -  Altri trasferimenti in conto capitale';
 c2 := '(-)';
 c5 := 'EQREG-COR_SpeseTitolo2.04';-- riga TAG BDAP
 n1 := 0;


 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and nb_macroaggregato = '204';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq - n1;

 -- ************************************
 -- riga 14 la inseriamo dopo la riga 43
 -- ************************************




 -- riga 15 Rimborso prestiti
 riga := 15;
 c1 := 'Rimborso prestiti';
 c2 := '(-)';
 c5 := 'EQREG-COR_RimborsoPrestiti';-- riga TAG BDAP
 n1 := 0;


 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '4';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq - n1;

 -- riga 16 - di cui  Fondo anticipazioni di liquidità (DL 35/2013 e successive modifiche e rifinanziamenti) 
 riga := 16;
 c1 := '- di cui  Fondo anticipazioni di liquidità (DL 35/2013 e successive modifiche e rifinanziamenti) ';
 c2 := '';
 c5 := 'EQREG-COR_RimborsoPrestitiFAL';-- riga TAG BDAP
 n1 := 0;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;


-- riga 17 - di cui per estinzione anticipata di prestiti 
 riga := 17;
 c1 := '- di cui per estinzione anticipata di prestiti';
 c2 := '';
 c5 := 'EQREG-COR_RimborsoPrestitiEAP';-- riga TAG BDAP
 n1 := 0;


 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

-- ***************************************
-- riga 18 inserita dopo la 41 e la 14
-- ***************************************


-- riga 19 Utilizzo risultato di amministrazione  per il finanziamento di spese d’investimento
 riga := 19;
 n1 := 0;
 c1 := 'Utilizzo risultato di amministrazione  per il finanziamento di spese di investimento';
 c2 := '(+)';
 c5 := 'EQREG-CAP_UtilizzoRisultatoAmmFinanzSpeseInvestimento';-- riga TAG BDAP

      select nvl(sum(avanzo_vincolato),0) into n1
      from fin_t_consuntivo_excel
      where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = 2
      and nvl(AVANZO_VINCOLATO,0) > 0;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq + n1;


-- riga 20 Fondo pluriennale vincolato per spese in conto capitale iscritto in entrata
 riga := 20;
 c1 := 'Fondo pluriennale vincolato per spese in conto capitale iscritto in entrata';
 c2 := '(+)';
 c5 := 'EQREG-CAP_FPVSpeseCCapitaleIscrittoEntrata';-- riga TAG BDAP
 n1 := 0;

 select 
    NVL(SUM(nvl(FPV_FONTE,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '2';

  INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
 commit;

 B_eq := B_eq + n1;

 -- riga 21 Entrate in conto capitale (Titolo 4)
 riga := 21;
 c1 := 'Entrate in conto capitale (Titolo 4)';
 c2 := '(+)';
 c5 := 'EQREG-CAP_EntrateContoCapitale';-- riga TAG BDAP
 n1 := 0;


select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO1,1,1) = '4';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq + n1;

-- riga 22 Entrate Titolo 5.01.01 -  Alienazioni  di partecipazioni 
riga := 22;
 c1 := 'Entrate Titolo 5.01.01 -  Alienazioni  di partecipazioni';
 c2 := '(+)';
 c5 := 'EQREG-CAP_EntrateTitolo5.01.01';-- riga TAG BDAP
 n1 := 0;


 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO3,1,5) = '50101';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq + n1;


-- riga 23 Entrate per accensioni di prestiti (titolo 6)
 riga := 23;
 c1 := 'Entrate per accensioni di prestiti (titolo 6)';
 c2 := '(+)';
 c5 := 'EQREG-CAP_EntrateAccensioniPrestiti';-- riga TAG BDAP
 n1 := 0;


select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO1,1,1) = '6';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq + n1;

-- riga 24 Entrate in conto capitale per Contributi agli investimenti direttamente destinati al rimborso dei prestiti da amministrazioni pubbliche (2)
 riga := 24;
 c1 := 'Entrate in conto capitale per Contributi agli investimenti direttamente destinati al rimborso dei prestiti da amministrazioni pubbliche (2)';
 c2 := '(-)';
 c5 := 'EQREG-CAP_EntrateCCapitaleContribInvestRimborsoPrestitiPA';-- riga TAG BDAP
 n1 := 0;


 -- ricavo n1 da fnd_reports_importi_man
 -- *** coincide con il valore della riga 6 ****
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_6'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq - n1;


-- riga 25 Entrate in c/capitale destinate all'estinzione anticipata di prestiti
 riga := 25;
 c1 := 'Entrate in c/capitale destinate all''estinzione anticipata di prestiti';
 c2 := '(-)';
 c5 := 'EQREG-CAP_EntrateCCapitaleEAP';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
 -- *** coincide con il valore della riga 8 ****
  begin 
   select nvl(importo,0)
   into n1
   and id_report = p_id_report;
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_8'
   and valore_parametro_anno = p_anno
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq - n1;

-- riga 26 Entrate di parte capitale destinate a spese correnti in base a specifiche disposizioni di legge o  dei principi contabili
 riga := 26;
 c1 := 'Entrate di parte capitale destinate a spese correnti in base a specifiche disposizioni di legge o  dei principi contabili';
 c2 := '(-)';
 c5 := 'EQREG-CAP_EntrateParteCapitaleDestinateSpeseCorrenti';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
 -- *** coincide con il valore della riga 10 ****
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_10'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq - n1;

-- riga 27 Entrate per accensioni di prestiti destinate all'estinzione anticipata di prestiti
 riga := 27;
 c1 := 'Entrate per accensioni di prestiti destinate all''estinzione anticipata di prestiti';
 c2 := '(-)';
 c5 := 'EQREG-CAP_EntrateAccensPrestitiEAP';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
 -- *** coincide con il valore della riga 9 ****
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_9'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq - n1;


-- riga 28 Entrate Titolo  4.03   - Altri trasferimenti in conto capitale
 riga := 28;
 c1 := 'Entrate Titolo  4.03   - Altri trasferimenti in conto capitale';
 c2 := '(-)';
 c5 := 'EQREG-CAP_EntrateTitolo4.03';-- riga TAG BDAP
 n1 := 0;

 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO2,1,3) = '403';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq - n1;

 -- riga 29 Spese in conto capitale
 riga := 29;
 c1 := 'Spese in conto capitale';
 c2 := '(-)';
 c5 := 'EQREG-CAP_SpeseContoCapitale';-- riga TAG BDAP
 n1 := 0;


select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '2';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq - n1;

/*
-- riga 30 Fondo pluriennale vincolato di parte capital (di spesa)
 riga := 30;
 c1 := 'Fondo pluriennale vincolato in c/capitale (di spesa)';
 c2 := '(-)';
 c5 := 'EQREG-CAP_SpeseContoCapitaleFPV';-- riga TAG BDAP
 n1 := fpv_u_capitale;


 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq - n1;
*/
-- riga 31 Spese Titolo 2.04 -  Altri trasferimenti in conto capitale
 riga := 31;
 c1 := 'Spese Titolo 2.04 -  Altri trasferimenti in conto capitale';
 c2 := '(+)';
 c5 := 'EQREG-CAP_SpeseTitolo2.04';-- riga TAG BDAP
 n1 := 0;


 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and nb_macroaggregato = '204';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq + n1;

-- riga 32 Spese Titolo 3.01.01 - Acquisizioni di partecipazioni e conferimenti di capitale 
riga := 32;
 n1 := 0;
 c1 := 'Spese Titolo 3.01.01 - Acquisizioni di partecipazioni e conferimenti di capitale ';
 c2 := '(-)';
 c5 := 'EQREG-CAP_SpeseTitolo3.01.01';-- riga TAG BDAP


 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and substr(nb_piano_conti_fina,3,7) = '3.01.01';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq - n1;

/*
-- riga 33 Disavanzo pregresso derivante da debito autorizzato e non contratto 
 riga := 33;
 c1 := 'Disavanzo pregresso derivante da debito autorizzato e non contratto ';
 c2 := '(-)';
 c5 := 'EQREG-CAP_DisavanzoPregressoDebitoAutorizzatoNonContratto';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_33'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq - n1;


-- ****************************************
-- Righe 34 e 35 inserite dopo la riga 41
-- ****************************************


-- riga 36 Utilizzo risultato di amministrazione per  l'incremento di  attività finanziarie 
 riga := 36;
 c1 := 'Utilizzo risultato di amministrazione per  l''incremento di  attività finanziarie';
 c2 := '(+)';
 c5 := 'EQREG-VAR_UtilizzoRisultatoAmmFinanzAttivitaFinanziarie';-- riga TAG BDAP
 n1 := 0;


-- ricavo n1 da fnd_reports_importi_man
  begin 
   select nvl(importo,0)
   into n1
   from fnd_reports_importi_man
   where nome_campo_report = 'XXX_36'
   and valore_parametro_anno = p_anno
   and id_report = p_id_report;
   exception when no_data_found then n1 := 0;
  end;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

C_eq := C_eq + n1;
*/
-- riga 37 Entrate titolo 5.00  -  Riduzioni attività finanziarie 
 riga := 37;
 c1 := 'Entrate titolo 5.00  -  Riduzioni attività finanziarie ';
 c2 := '(+)';
 c5 := 'EQREG-VAR_EntrateTitolo5.00';-- riga TAG BDAP
 n1 := 0;

 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO1,1,1) = '5';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

C_eq := C_eq + n1;

 -- riga 38 Spese titolo 3.00 - Incremento attività finanziarie
 riga := 38;
 c1 := 'Spese titolo 3.00 - Incremento attività finanziarie';
 c2 := '(-)';
 c5 := 'EQREG-VAR_SpeseTitolo3.00';-- riga TAG BDAP
 n1 := 0;


select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_TITOLO = '3';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

C_eq := C_eq - n1;


-- riga 39 Entrate Titolo 5.01.01 -  Alienazioni  di partecipazioni 
riga := 39;
 c1 := 'Entrate Titolo 5.01.01 -  Alienazioni  di partecipazioni';
 c2 := '(-)';
 c5 := 'EQREG-VAR_EntrateTitolo5.01.01';-- riga TAG BDAP
 n1 := 0;


 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO3,1,5) = '50101';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

C_eq := C_eq - n1;

-- riga 40 Spese Titolo 3.01.01 - Acquisizioni di partecipazioni e conferimenti di capitale 
riga := 40;
 c1 := 'Spese Titolo 3.01.01 - Acquisizioni di partecipazioni e conferimenti di capitale ';
 c2 := '(+)';
 c5 := 'EQREG-VAR_SpeseTitolo3.01.01';-- riga TAG BDAP
 n1 := 0;


 select 
    where ANNO_CONSUNTIVO = p_anno
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and substr(nb_piano_conti_fina,3,7) = '3.01.01';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

C_eq := C_eq + n1;


-- riga 41 C) Variazioni attività finanziaria
 riga := 41;
 c1 := 'C) Variazioni attivita'' finanziaria';
 c2 := '';
 c4 := 'E';
 c5 := ''; --riga TAG BDAP
 n1 := C_eq;



INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car04,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c4,c5,n1,p_utente,riga,p_anno,'S');  
commit;


-- ****** da inserire dopo la riga 41 Variazioni di attività finanziarie V_eq
-- riga 14 Variazioni di attività finanziarie (se negativo) 
 riga := 14;
 c1 := 'Variazioni di attività finanziarie (se negativo)';
 c2 := '(-)';
 c5 := 'EQREG-COR_VariazioniAttivitaFinanziarieNegativo';-- riga TAG BDAP
 n1 := 0;

  if C_eq &lt; 0
  then n1 := C_eq;
  end if;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

A_eq := A_eq - n1;

-- riga 18 A) Equilibrio di parte corrente
 riga := 18;
 c1 := 'A) Equilibrio di parte corrente';
 c2 := '';
 c4 := 'E';
 c5 := 'EQREG-COR_EquilibrioParteCorrente';-- riga TAG BDAP
 n1 := A_eq;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car04,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c4,c5,n1,p_utente,riga,p_anno,'S');  
commit;

-- riga 34 Variazioni di attività finanziarie (se positivo) 
 riga := 34;
 c1 := 'Variazioni di attività finanziarie (se positivo)';
 c2 := '(+)';
 c5 := 'EQREG-CAP_VariazioniAttivitaFinanziariePositivo';-- riga TAG BDAP
 n1 := 0;

  if C_eq > 0
  then n1 := C_eq;
  end if;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

B_eq := B_eq + n1;

-- riga 35 B) Equilibrio di parte capitale
 riga := 35;
 c1 := 'B) Equilibrio di parte capitale';
 c2 := '';
 c4 := 'E';
 c5 := 'EQREG-CAP_EquilibrioParteCapitale';-- riga TAG BDAP
 n1 := B_eq;

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car04,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c4,c5,n1,p_utente,riga,p_anno,'S');  
commit;


-- riga 42 Entrate categoria 9010400: Anticipazioni finanziamento sanità incassate nell'anno

riga := 42;
 c1 := 'Entrate categoria 9010400: Anticipazioni finanziamento sanità incassate nell''anno';
 c2 := '(+)';
 c5 := '';-- riga TAG BDAP
 n1 := 0;

 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and NB_LIVELLO3 = '9010400';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

D_eq := D_eq + n1;

-- riga 43 Spese missione 99.02: Rimborsi anticipazione sanità pagate nell'anno

riga := 43;
 c1 := 'Spese missione 99.02: Rimborsi anticipazione sanità pagate nell''anno';
 c2 := '(-)';
 c5 := '';-- riga TAG BDAP
 n1 := 0;

 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and NB_LIVELLO1||'.'||NB_LIVELLO2 = '99.01';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

D_eq := D_eq - n1;

-- riga 44 D) Saldo Anticipazioni/Rimborsi sanità dell'anno

riga := 44;
 c1 := 'D) Saldo Anticipazioni/Rimborsi sanità dell''anno';
 c2 := '';
 c5 := '';-- riga TAG BDAP
 n1 := D_eq;


INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;


-- riga 45 Entrate per conto terzi e partite di giro (Titolo 9) al netto di "Entrate categoria 9010400"
 riga := 45;
 c1 := 'Entrate per conto terzi e partite di giro (Titolo 9) al netto di "Entrate categoria 9010400"';
 c2 := '(+)';
 c5 := '';-- riga TAG BDAP
 n1 := 0;

select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
      and UTENTE = p_utente
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and substr(NB_LIVELLO1,1,1) = '9'
      and NB_LIVELLO3 &lt;> '9010400';

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

E_eq := E_eq + n1;

-- riga 46 Uscite per conto terzi e partite di giro (Titolo 7) al netto di "Spese missione 99.02"
riga := 46;
 c1 := 'Uscite per conto terzi e partite di giro (Titolo 7) al netto di "Spese missione 99.02"';
 c2 := '(-)';
 c5 := '';-- riga TAG BDAP
 n1 := 0;

 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and nb_titolo = 7
      and NB_LIVELLO1||'.'||NB_LIVELLO2 &lt;> '99.01';

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

E_eq := E_eq - n1;



-- riga 47 E) Saldo conto terzi e partite di giro

riga := 47;
 c1 := 'E) Saldo conto terzi e partite di giro';
 c2 := '';
 c5 := '';-- riga TAG BDAP
 n1 := E_eq;


INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

-- riga 48 Entrate titolo 7 - Anticipazioni da tesoriere
 riga := 48;
 c1 := 'Entrate titolo 7 - Anticipazioni da tesoriere';
 c2 := '(+)';
 c5 := '';-- riga TAG BDAP
 n1 := 0;

select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'E'
      and UTENTE = p_utente
      and substr(NB_LIVELLO1,1,1) = '7';

INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

F_eq := F_eq + n1;


-- riga 49 Spese titolo 5 - Chiusura Anticipazioni tesoriere
riga := 49;
 c1 := 'Spese titolo 5 - Chiusura Anticipazioni tesoriere';
 c2 := '(-)';
 c5 := '';-- riga TAG BDAP
 n1 := 0;

 select 
   NVL(SUM(nvl(riscossioni_pagamenti_totale,0)),0)
    into n1
    from fin_t_consuntivo_excel
    where ANNO_CONSUNTIVO = p_anno
      and TIPO_CAPITOLO = 'U'
      and UTENTE = p_utente
      and nb_titolo = 5;

 INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
 VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

F_eq := F_eq - n1;


-- riga 50 F) Saldo antcipazioni/rimborsi tesoriere

riga := 50;
 c1 := 'F) Saldo antcipazioni/rimborsi tesoriere';
 c2 := '';
 c5 := '';-- riga TAG BDAP
 n1 := F_eq;


INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;


-- riga 51 EQUILIBRIO FINALE (G=A+B+D+E+F)

riga := 54;
 c1 := 'EQUILIBRIO FINALE (G=A+B+D+E+F)';
 c2 := '';
 c5 := '';-- riga TAG BDAP
 n1 := A_eq+ B_eq + D_eq + E_eq + F_eq;


INSERT INTO fin_t_rendiconto_equilibri (car01,car02,car05,num01,utente,num_ord_riga,anno,cassa) 
VALUES (c1,c2,c5,n1,p_utente,riga,p_anno,'S');  
commit;

END;</pre>	</td></tr>
</table></div>