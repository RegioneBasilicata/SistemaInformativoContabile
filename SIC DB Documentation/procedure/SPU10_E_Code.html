<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="../dbdoc.js" type="text/javascript"></script>
<link href="../dbdoc.css" type="text/css" rel="stylesheet">
</head>
<body class="object">
<div id="header"><h2>SPU10_E</h2>
<div class="tabs clearfix">

<div class="tab"><div><a href="SPU10_E.html">Details</a></div></div>
<div class="tab"><div><a href="SPU10_E_Grants.html">Grants</a></div></div>
<div class="tab"><div><a href="SPU10_E_References.html">References</a></div></div>
<div class="tab"><div><a href="SPU10_E_Dependencies.html">Dependencies</a></div></div>
<div class="tab" id="current"><div><a href="SPU10_E_Code.html">Code</a></div></div>
</div></div><br/>
<div class="tab-panes">
<div id="Code"> <table cellpadding="0" cellspacing="0" cellspacing="0" summary=""><tr>
	<th>TEXT</th>
</tr>
	<tr><td><pre>
PROCEDURE SPU10_E (p_anno IN NUMBER) is

cursor capitoli is
select  nvl(nb1.codice,'Da Def.') nb_titolo
   ,nb1.descrizione nb_desc_titolo
   ,nvl(nb2.codice,'Da Def.') nb_tipologia
   ,nb2.descrizione nb_desc_tipologia
   ,nvl(nb3.codice,'Da Def.') nb_categoria 
   ,nb3.descrizione nb_desc_categoria,
bc.EU||bc.CODICE codice_capitolo_e,
bc.DESCRIZIONE desc_capitolo_e,
(nvl(fb.previsto_attuale,0) +
nvl(fb.variazione_competenza_piu,0) + nvl(fb.assestamento_competenza_piu,0) - nvl(fb.variazione_competenza_meno,0) - nvl(fb.assestamento_competenza_meno,0)) Stanziamento_finale_E,
nvl(fb.IMPEGNI_ACCERTAMENTI_COMPE,0) Accertato,
nvl(fb.MANDATI_REVERSALI_COMPE,0) Incassato_E,
((nvl(fb.previsto_attuale,0) +
nvl(fb.variazione_competenza_piu,0) + nvl(fb.assestamento_competenza_piu,0) - nvl(fb.variazione_competenza_meno,0) - nvl(fb.assestamento_competenza_meno,0))
- nvl(fb.IMPEGNI_ACCERTAMENTI_COMPE,0)) Magg_Min_Accertamento,
(nvl(fb.IMPEGNI_ACCERTAMENTI_COMPE,0) - nvl(fb.MANDATI_REVERSALI_COMPE,0)) Residui_Effettivi
from	fina_articoli  bc,
	fina_bilancio fb,
  nb_livello1 nb1,
  nb_livello2 nb2,
  nb_livello3 nb3  
where	bc.anno = p_anno AND
bc.EU = 'E' and
bc.codice not in ('00001','00002','00003') and
fb.anno  = p_anno and
fb.eu||FB.articolo = bc.EU||bc.CODICE 
and bc.nb_id_padre = nb3.id(+)
and nb2.id(+) = nb3.id_livello2
and nb1.id(+) = nb2.id_livello1
order by bc.EU||bc.CODICE;

begin
delete fin_t_spu10 where anno = p_anno and eu = 'E';
commit;
 for cap in capitoli loop
  insert into fin_t_spu10 (ANNO,EU,CAPITOLO,DESCRIZIONE,STANZ_FINALE,ACC_IMP,INC_PAG,MAGG_RES,RES_EFFETTIVI
  ,TITOLO,DESC_TITOLO,TIPOLOGIA,DESC_TIPOLOGIA,CATEGORIA,DESC_CATEGORIA)
  values(p_anno,'E',cap.codice_capitolo_e,cap.desc_capitolo_e,cap.Stanziamento_finale_E,cap.Accertato,cap.Incassato_E,cap.Magg_Min_Accertamento,cap.Residui_Effettivi
  ,cap.nb_titolo,cap.nb_desc_titolo,cap.nb_tipologia,cap.nb_desc_tipologia,cap.nb_categoria,cap.nb_desc_categoria);
  commit;  
 end loop;
end;</pre>	</td></tr>
</table></div>