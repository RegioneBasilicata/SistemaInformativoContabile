<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="../dbdoc.js" type="text/javascript"></script>
<link href="../dbdoc.css" type="text/css" rel="stylesheet">
</head>
<body class="object">
<div id="header"><h2>SPU10_U</h2>
<div class="tabs clearfix">

<div class="tab"><div><a href="SPU10_U.html">Details</a></div></div>
<div class="tab"><div><a href="SPU10_U_Grants.html">Grants</a></div></div>
<div class="tab"><div><a href="SPU10_U_References.html">References</a></div></div>
<div class="tab"><div><a href="SPU10_U_Dependencies.html">Dependencies</a></div></div>
<div class="tab" id="current"><div><a href="SPU10_U_Code.html">Code</a></div></div>
</div></div><br/>
<div class="tab-panes">
<div id="Code"> <table cellpadding="0" cellspacing="0" cellspacing="0" summary=""><tr>
	<th>TEXT</th>
</tr>
	<tr><td><pre>
Procedure SPU10_U (p_anno IN NUMBER) is
Liquidato number := 0;

cursor capitoli is
select bc.eu||bc.codice codice_capitolo_u,
bc.eu||bc.codice codice_capitolo_u_stampa,
bc.descrizione desc_capitolo_u,
bc.codice_meccanografico codice_meccanografico_u,
nvl(ftb.previsto_attuale,0) + 
nvl(ftb.variazione_competenza_piu,0) + nvl(ftb.assestamento_competenza_piu,0) - nvl(ftb.variazione_competenza_meno,0) - nvl(ftb.assestamento_competenza_meno,0) Stanziamento_Finale_u,
nvl(ftb.IMPEGNI_ACCERTAMENTI_COMPE,0) Impegnato,
nvl(ftb.MANDATI_REVERSALI_COMPE,0) Pagato,
(nvl(ftb.previsto_attuale,0) +
nvl(ftb.variazione_competenza_piu,0) + nvl(ftb.assestamento_competenza_piu,0) 
- nvl(ftb.variazione_competenza_meno,0) - nvl(ftb.assestamento_competenza_meno,0) 
- nvl(ftb.IMPEGNI_ACCERTAMENTI_COMPE,0)) Residuo_di_stanziamento_u,
(nvl(ftb.IMPEGNI_ACCERTAMENTI_COMPE,0) - nvl(ftb.MANDATI_REVERSALI_COMPE,0)) Residui_effettivi_u
from fina_articoli bc,
fina_bilancio ftb
where bc.anno = p_anno AND
bc.eu = 'U' and
bc.codice not in ('00001','00002') and
ftb.eu||ftb.articolo = bc.eu||bc.codice and
ftb.anno = bc.anno;

begin
delete fin_t_spu10 where anno = p_anno and eu = 'U';
commit;

for cap in capitoli loop
 begin
  select sum(nvl(jugd1.document_amount,0)) into Liquidato
  FROM
  fina_documenti jugd1
  ,fina_documenti jugd2
  WHERE
  upper(jugd1.doc_type) = 'LIQ' and
  upper(nvl(jugd1.proposal_status_flag,'Z'))||upper(nvl(jugd1.auditing_status_flag,'Z')) ='PI' and
  upper(nvl(jugd1.deletion_status_flag,'N')) &lt;> 'Y' and
  to_number(to_char(jugd1.date_created,'yyyy')) = p_anno and
  jugd1.segment2 = cap.codice_capitolo_u and
  jugd2.doc_id = jugd1.previous_doc_id and
  jugd2.segment8 = p_anno;
  exception when no_data_found then Liquidato := 0;
 end;
  insert into fin_t_spu10 (ANNO,EU,CAPITOLO,DESCRIZIONE,STANZ_FINALE,ACC_IMP,LIQUIDATO,INC_PAG,MAGG_RES,RES_EFFETTIVI)
  values (p_anno,'U',cap.codice_capitolo_u,cap.desc_capitolo_u,cap.Stanziamento_finale_U,cap.Impegnato,nvl(Liquidato,0),cap.Pagato,cap.Residuo_di_stanziamento_u,cap.Residui_effettivi_u);
  Liquidato := 0;
  commit;
 end loop;
end;</pre>	</td></tr>
</table></div>